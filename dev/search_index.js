var documenterSearchIndex = {"docs":
[{"location":"inverse/#Inverse-Modeling-for-Coupled-Geomechanics-and-Single-Phase-Flow-1","page":"Inverse Modeling for Coupled Geomechanics and Single Phase Flow","title":"Inverse Modeling for Coupled Geomechanics and Single Phase Flow","text":"","category":"section"},{"location":"inverse/#","page":"Inverse Modeling for Coupled Geomechanics and Single Phase Flow","title":"Inverse Modeling for Coupled Geomechanics and Single Phase Flow","text":"We have coupled geomechanics and single phase flow in Coupled Geomechanics and Single Phase Flow. Now we consider the inverse modeling: assuming that the plane stress elasticity matrix H is unknown, we want to estimate H based on the observation data– the displacement and velocity on a line of sensors.","category":"page"},{"location":"inverse/#","page":"Inverse Modeling for Coupled Geomechanics and Single Phase Flow","title":"Inverse Modeling for Coupled Geomechanics and Single Phase Flow","text":"In the inverse modeling code, we need to replace for loops by while_loop syntax. Additionally, we need to using Variable(H) to mark H as trainable. We run the L-BFGS-B algorithm and obtain the following loss function profile and estimated H. ","category":"page"},{"location":"inverse/#","page":"Inverse Modeling for Coupled Geomechanics and Single Phase Flow","title":"Inverse Modeling for Coupled Geomechanics and Single Phase Flow","text":"u displacement v displacement Pressure\n(Image: ) (Image: ) (Image: )","category":"page"},{"location":"inverse/#","page":"Inverse Modeling for Coupled Geomechanics and Single Phase Flow","title":"Inverse Modeling for Coupled Geomechanics and Single Phase Flow","text":"Code","category":"page"},{"location":"inverse/#","page":"Inverse Modeling for Coupled Geomechanics and Single Phase Flow","title":"Inverse Modeling for Coupled Geomechanics and Single Phase Flow","text":"(Image: )","category":"page"},{"location":"inverse/#","page":"Inverse Modeling for Coupled Geomechanics and Single Phase Flow","title":"Inverse Modeling for Coupled Geomechanics and Single Phase Flow","text":"Initial Guess Estimated H Reference H\nbeginbmatrix1    0  0  0  1   0  0      0      1endbmatrix beginbmatrix113961     0398872     -235165times10^-6 0398842    113959      439933times10^-6 374498times10^-6  238203times10^-6   0740731endbmatrix beginbmatrix11396    039886  00  039886  11396   00  00      00      0740741endbmatrix","category":"page"},{"location":"staticelasticity/#Static-Linear-Elasticity-1","page":"Static Linear Elasticity","title":"Static Linear Elasticity","text":"","category":"section"},{"location":"staticelasticity/#","page":"Static Linear Elasticity","title":"Static Linear Elasticity","text":"The governing equation for static linear elasticity is","category":"page"},{"location":"staticelasticity/#","page":"Static Linear Elasticity","title":"Static Linear Elasticity","text":"beginaligned\nmathrmdiv sigma(u) = f(x)  xin Omega \nsigma(u) = Cvarepsilon(u) \nu(x) = u_0(x)  xin Gamma_u\nsigma(x) n(x) = t(x)  xin Gamma_n\nendaligned","category":"page"},{"location":"staticelasticity/#","page":"Static Linear Elasticity","title":"Static Linear Elasticity","text":"Here varepsilon(u) = frac12(nabla u + (nabla u)^T) is the Cauchy tensor, Gamma_u cup Gamma_n = Omega, Gamma_u cap Gamma_n = emptyset. The weak formulation is: finding u such that ","category":"page"},{"location":"staticelasticity/#","page":"Static Linear Elasticity","title":"Static Linear Elasticity","text":"int_Omega delta varepsilon(u)  C varepsilon(u)mathrmd x = int_Gamma_n tcdotdelta u mathrmds - int_Omega fcdot delta u mathrmdx","category":"page"},{"location":"staticelasticity/#","page":"Static Linear Elasticity","title":"Static Linear Elasticity","text":"We consider the manufactured solution ","category":"page"},{"location":"staticelasticity/#","page":"Static Linear Elasticity","title":"Static Linear Elasticity","text":"u(x) = beginbmatrix\nx_1^2+x_2^2\nx_1^2-x_2^2\nendbmatrix","category":"page"},{"location":"staticelasticity/#","page":"Static Linear Elasticity","title":"Static Linear Elasticity","text":"and ","category":"page"},{"location":"staticelasticity/#","page":"Static Linear Elasticity","title":"Static Linear Elasticity","text":"beginbmatrix\nsigma_xx\nsigma_yy\nsigma_xy\nendbmatrix = beginbmatrix\n1  0  0\n0  1  0\n0  0  12\nendbmatrixbeginbmatrix\nvarepsilon_xx\nvarepsilon_yy\n2varepsilon_xy\nendbmatrix","category":"page"},{"location":"staticelasticity/#","page":"Static Linear Elasticity","title":"Static Linear Elasticity","text":"then we have ","category":"page"},{"location":"staticelasticity/#","page":"Static Linear Elasticity","title":"Static Linear Elasticity","text":"f(x) = beginbmatrix\n3\n-1\nendbmatrix","category":"page"},{"location":"staticelasticity/#","page":"Static Linear Elasticity","title":"Static Linear Elasticity","text":"We let Gamma_n be the top boundary. ","category":"page"},{"location":"staticelasticity/#","page":"Static Linear Elasticity","title":"Static Linear Elasticity","text":"bdedge = []\nfor i = 1:m \n    push!(bdedge, [i i+1])\nend\nbdedge = vcat(bdedge...)\n\nbdnode = Int64[]\nfor j = 1:n+1\n    push!(bdnode, (j-1)*(m+1)+1)\n    push!(bdnode, (j-1)*(m+1)+m+1)\nend\nfor i = 2:m\n    push!(bdnode, n*(m+1)+i)\nend\n\nF1 = eval_f_on_gauss_pts((x,y)->3.0, m, n, h)\nF2 = eval_f_on_gauss_pts((x,y)->-1.0, m, n, h)\nF = compute_fem_source_term(F1, F2, m, n, h)\n\nt1 = eval_f_on_boundary_edge((x,y)->-x-y, bdedge, m, n, h)\nt2 = eval_f_on_boundary_edge((x,y)->2y, bdedge, m, n, h)\nT = compute_fem_traction_term([t1 t2], bdedge, m, n, h)\n\nD = diagm(0=>[1,1,0.5])\nK = compute_fem_stiffness_matrix(D, m, n, h)\nrhs = T - F \nbdval = [eval_f_on_boundary_node((x,y)->x^2+y^2, bdnode, m, n, h);\n        eval_f_on_boundary_node((x,y)->x^2-y^2, bdnode, m, n, h)]\nrhs[[bdnode;bdnode .+ (m+1)*(n+1)]] = bdval\nK, Kbd = fem_impose_Dirichlet_boundary_condition(K, bdnode, m, n, h)\nu = K\\(rhs-Kbd*bdval)\nX, Y, U, V = plot_u(u, m, n, h)\n\nfigure(figsize=[10,4])\nsubplot(121)\npcolormesh(X, Y, (@. X^2+Y^2-U), alpha=0.6); xlabel(\"x\"); ylabel(\"y\"); title(\"Error for u\")\ncolorbar()\nsubplot(122)\npcolormesh(X, Y, (@. X^2-Y^2-V), alpha=0.6); xlabel(\"x\"); ylabel(\"y\"); title(\"Error for v\")\ncolorbar()","category":"page"},{"location":"staticelasticity/#","page":"Static Linear Elasticity","title":"Static Linear Elasticity","text":"(Image: )","category":"page"},{"location":"api/#API-1","page":"API","title":"API","text":"","category":"section"},{"location":"api/#Data-Structures-1","page":"API","title":"Data Structures","text":"","category":"section"},{"location":"api/#","page":"API","title":"API","text":"PoreData","category":"page"},{"location":"api/#PoreFlow.PoreData","page":"API","title":"PoreFlow.PoreData","text":"PoreData is a collection of physical parameters for coupled geomechanics and flow simulation\n\nM: Biot modulus\nb: Biot coefficient\nρb: Bulk density\nρf: Fluid density\nkp: Permeability\nE: Young modulus\nν: Poisson ratio\nμ: Fluid viscosity\nPi: Initial pressure\nBf: formation volume, B_f=fracrho_f0rho_f\ng: Gravity acceleration\n\n\n\n\n\n","category":"type"},{"location":"api/#Matrix-Assembling-Functions-1","page":"API","title":"Matrix Assembling Functions","text":"","category":"section"},{"location":"api/#","page":"API","title":"API","text":"compute_fem_stiffness_matrix\ncompute_interaction_matrix\ncompute_fvm_tpfa_matrix\ncompute_fem_mass_matrix\ncompute_fvm_mass_matrix\ncompute_fem_mass_matrix1\ncompute_fem_stiffness_matrix1","category":"page"},{"location":"api/#PoreFlow.compute_fem_stiffness_matrix","page":"API","title":"PoreFlow.compute_fem_stiffness_matrix","text":"compute_fem_stiffness_matrix(K::Array{Float64,2}, m::Int64, n::Int64, h::Float64)\n\nComputes the term \n\nint_Adelta varepsilon sigmamathrmdx = int_A u_AB^TDBdelta u_Amathrmdx\n\n\n\n\n\n","category":"function"},{"location":"api/#PoreFlow.compute_interaction_matrix","page":"API","title":"PoreFlow.compute_interaction_matrix","text":"compute_interaction_matrix(m::Int64, n::Int64, h::Float64)\n\nComputes the interaction term \n\nint_A p delta varepsilon_vmathrmdx = int_A p 110B^Tdelta u_Amathrmdx\n\nThe output is a mn times 2(m+1)(n+1) matrix. \n\n\n\n\n\n","category":"function"},{"location":"api/#PoreFlow.compute_fvm_tpfa_matrix","page":"API","title":"PoreFlow.compute_fvm_tpfa_matrix","text":"compute_fvm_tpfa_matrix(m::Int64, n::Int64, h::Float64)\n\nComputes the term with two-point flux approximation \n\nint_A_i Delta p mathrmdx = sum_j=1^n_mathrmfaces (p_j-p_i)\n\n(Image: )\n\nwarning: Warning\nNo flow boundary condition is assumed. \n\n\n\n\n\ncompute_fvm_tpfa_matrix(K::Array{Float64}, m::Int64, n::Int64, h::Float64)\n\nComputes the term with two-point flux approximation with distinct permeability at each cell\n\nint_A_i K_i Delta p mathrmdx = K_isum_j=1^n_mathrmfaces (p_j-p_i)\n\n\n\n\n\n","category":"function"},{"location":"api/#PoreFlow.compute_fem_mass_matrix","page":"API","title":"PoreFlow.compute_fem_mass_matrix","text":"compute_fem_mass_matrix(m::Int64, n::Int64, h::Float64)\n\nComputes the finite element mass matrix \n\nint_Omega u delta u mathrmdx\n\nThe matrix size is 2(m+1)(n+1) times 2(m+1)(n+1).\n\n\n\n\n\n","category":"function"},{"location":"api/#PoreFlow.compute_fvm_mass_matrix","page":"API","title":"PoreFlow.compute_fvm_mass_matrix","text":"compute_fvm_mass_matrix(m::Int64, n::Int64, h::Float64)\n\nReturns the FVM mass matrix \n\nint_A_i p_i mathrmdx = h^2 p_i \n\n\n\n\n\n","category":"function"},{"location":"api/#PoreFlow.compute_fem_mass_matrix1","page":"API","title":"PoreFlow.compute_fem_mass_matrix1","text":"compute_fem_mass_matrix1(ρ::Array{Float64}, m::Int64, n::Int64, h::Float64)\n\nComputes the mass matrix for a scalar value u\n\nint_A rho u delta u mathrmd x\n\nThe output is a (m+1)*(n+1) sparse matrix. \n\n\n\n\n\ncompute_fem_mass_matrix1(m::Int64, n::Int64, h::Float64)\n\nComputes the mass matrix for a scalar value u\n\n\\int_A u \\delta u \\mathrm{d} x\n\nThe output is a (m+1)*(n+1) sparse matrix. \n\n\n\n\n\n","category":"function"},{"location":"api/#PoreFlow.compute_fem_stiffness_matrix1","page":"API","title":"PoreFlow.compute_fem_stiffness_matrix1","text":"compute_fem_stiffness_matrix1(K::Array{Float64,2}, m::Int64, n::Int64, h::Float64)\n\nComputes the term \n\nint_A (K nabla u) cdot nabla delta u mathrmdx = int_A u_A B^T K B delta u_Amathrmdx\n\nReturns a (m+1)times (n+1) matrix\n\n\n\n\n\n","category":"function"},{"location":"api/#Vector-Assembling-Functions-1","page":"API","title":"Vector Assembling Functions","text":"","category":"section"},{"location":"api/#","page":"API","title":"API","text":"compute_fem_source_term\ncompute_fvm_source_term\ncompute_fvm_mechanics_term\ncompute_fem_normal_traction_term\ncompute_principal_stress_term\ncompute_fem_source_term1\ncompute_fem_flux_term1","category":"page"},{"location":"api/#PoreFlow.compute_fem_source_term","page":"API","title":"PoreFlow.compute_fem_source_term","text":"compute_fem_source_term(f1::Array{Float64}, f2::Array{Float64},\nm::Int64, n::Int64, h::Float64)\n\nComputes the term \n\nint_Omega fcdotdelta u dx\n\n\n\n\n\n","category":"function"},{"location":"api/#PoreFlow.compute_fvm_source_term","page":"API","title":"PoreFlow.compute_fvm_source_term","text":"compute_fvm_source_term(f::Array{Float64}, m::Int64, n::Int64, h::Float64)\n\nComputes the source term \n\nint_A_i fmathrmdx\n\n\n\n\n\n","category":"function"},{"location":"api/#PoreFlow.compute_fvm_mechanics_term","page":"API","title":"PoreFlow.compute_fvm_mechanics_term","text":"compute_fvm_mechanics_term(u::Array{Float64}, m::Int64, n::Int64, h::Float64)\n\nComputes the mechanic interaction term \n\nint_A_i varepsilon_vmathrmdx\n\nHere \n\nvarepsilon_v = mathrmtr varepsilon = varepsilon_xx + varepsilon_yy\n\nNumerically, we have \n\nvarepsilon_v = 1  1  0 B^T delta u_A\n\n\n\n\n\n","category":"function"},{"location":"api/#PoreFlow.compute_fem_normal_traction_term","page":"API","title":"PoreFlow.compute_fem_normal_traction_term","text":"compute_fem_normal_traction_term(t::Array{Float64,1}, bdedge::Array{Int64},\nm::Int64, n::Int64, h::Float64)\ncompute_fem_normal_traction_term(t::Float64, bdedge::Array{Int64},\nm::Int64, n::Int64, h::Float64)\n\nComputes the normal traction term \n\nint_Gamma t(mathbfn)cdotdelta u mathrmd\n\nHere t(mathbfn)parallelmathbfn points outward to the domain and the magnitude is given by t.  bdedge is a Ntimes2 matrix and each row denotes the indices of two endpoints of the boundary edge. \n\nSee compute_fem_traction_term for graphical illustration.\n\n\n\n\n\n","category":"function"},{"location":"api/#PoreFlow.compute_principal_stress_term","page":"API","title":"PoreFlow.compute_principal_stress_term","text":"compute_principal_stress_term(K::Array{Float64}, u::Array{Float64}, m::Int64, n::Int64, h::Float64)\n\nCompute the principal stress on the Gauss quadrature nodes. \n\n\n\n\n\n","category":"function"},{"location":"api/#PoreFlow.compute_fem_source_term1","page":"API","title":"PoreFlow.compute_fem_source_term1","text":"compute_fem_source_term1(f::Array{Float64},\nm::Int64, n::Int64, h::Float64)\n\nComputes the term \n\nint_Omega f delta u dx\n\nReturns a (m+1)times (n+1) vector. \n\n\n\n\n\n","category":"function"},{"location":"api/#PoreFlow.compute_fem_flux_term1","page":"API","title":"PoreFlow.compute_fem_flux_term1","text":"compute_fem_flux_term1(t::Array{Float64},\nbdedge::Array{Int64,2}, m::Int64, n::Int64, h::Float64)\n\nComputes the traction term \n\nint_Gamma q delta u mathrmd\n\n\n\n\n\n","category":"function"},{"location":"api/#Evaluation-Functions-1","page":"API","title":"Evaluation Functions","text":"","category":"section"},{"location":"api/#","page":"API","title":"API","text":"eval_f_on_gauss_pts\neval_f_on_boundary_node\neval_f_on_boundary_edge\neval_strain_on_gauss_pts","category":"page"},{"location":"api/#PoreFlow.eval_f_on_gauss_pts","page":"API","title":"PoreFlow.eval_f_on_gauss_pts","text":"eval_f_on_gauss_pts(f::Function, m::Int64, n::Int64, h::Float64)\n\nEvaluates f at Gaussian points and return the result as 4mn vector out (4 Gauss points per element)\n\n(Image: )\n\n\n\n\n\n","category":"function"},{"location":"api/#PoreFlow.eval_f_on_boundary_node","page":"API","title":"PoreFlow.eval_f_on_boundary_node","text":"eval_f_on_boundary_node(f::Function, bdnode::Array{Int64}, m::Int64, n::Int64, h::Float64)\n\nReturns a vector of the same length as bdnode whose entries corresponding to bdnode nodes are filled with values computed from f.\n\nf has the following signature \n\nf(x::Float64, y::Float64)::Float64\n\n\n\n\n\n","category":"function"},{"location":"api/#PoreFlow.eval_f_on_boundary_edge","page":"API","title":"PoreFlow.eval_f_on_boundary_edge","text":"eval_f_on_boundary_edge(f::Function, bdedge::Array{Int64,2}, m::Int64, n::Int64, h::Float64)\n\nReturns a vector of the same length as bdedge whose entries corresponding to bdedge nodes are filled with values computed from f.\n\nf has the following signature \n\nf(x::Float64, y::Float64)::Float64\n\n\n\n\n\n","category":"function"},{"location":"api/#PoreFlow.eval_strain_on_gauss_pts","page":"API","title":"PoreFlow.eval_strain_on_gauss_pts","text":"eval_strain_on_gauss_pts(u::Array{Float64}, m::Int64, n::Int64, h::Float64)\n\nComputes the strain on Gauss points.  Returns a 4mn times 3 matrix\n\n\n\n\n\n","category":"function"},{"location":"api/#Misc-1","page":"API","title":"Misc","text":"","category":"section"},{"location":"api/#","page":"API","title":"API","text":"fem_impose_Dirichlet_boundary_condition\nfem_impose_Dirichlet_boundary_condition1\ntrim_coupled\ncompute_elasticity_tangent\ncoupled_impose_pressure","category":"page"},{"location":"api/#PoreFlow.fem_impose_Dirichlet_boundary_condition","page":"API","title":"PoreFlow.fem_impose_Dirichlet_boundary_condition","text":"fem_impose_Dirichlet_boundary_condition(A::SparseMatrixCSC{Float64,Int64}, \nbd::Array{Int64}, m::Int64, n::Int64, h::Float64)\n\nImposes the Dirichlet boundary conditions on the matrix A.\n\nReturns 2 matrix, \n\nbeginbmatrix\nA_BB  A_BI  \nA_IB  A_II \nendbmatrix Rightarrow beginbmatrix\nI  0  \n0  A_II \nendbmatrix quad beginbmatrix\n0  \nA_IB \nendbmatrix\n\n\n\n\n\n","category":"function"},{"location":"api/#PoreFlow.fem_impose_Dirichlet_boundary_condition1","page":"API","title":"PoreFlow.fem_impose_Dirichlet_boundary_condition1","text":"fem_impose_Dirichlet_boundary_condition1(A::SparseMatrixCSC{Float64,Int64}, \n    bd::Array{Int64}, m::Int64, n::Int64, h::Float64)\n\nImposes the Dirichlet boundary conditions on the matrix A Returns 2 matrix, \n\nbeginbmatrix\nA_BB  A_BI  \nA_IB  A_II \nendbmatrix Rightarrow beginbmatrix\nI  0  \n0  A_II \nendbmatrix quad beginbmatrix\n0  \nA_IB \nendbmatrix\n\n\n\n\n\n","category":"function"},{"location":"api/#PoreFlow.trim_coupled","page":"API","title":"PoreFlow.trim_coupled","text":"trim_coupled(pd::PoreData, Q::SparseMatrixCSC{Float64,Int64}, L::SparseMatrixCSC{Float64,Int64}, \nM::SparseMatrixCSC{Float64,Int64}, \nbd::Array{Int64}, Δt::Float64, m::Int64, n::Int64, h::Float64)\n\nAssembles matrices from mechanics and flow and assemble the coupled matrix \n\nbeginbmatrix\nhat M  -hat L^T\nhat L  hat Q\nendbmatrix\n\nQ is obtained from compute_fvm_tpfa_matrix, M is obtained from compute_fem_stiffness_matrix, and L is obtained from compute_interaction_matrix.\n\n\n\n\n\n","category":"function"},{"location":"api/#PoreFlow.compute_elasticity_tangent","page":"API","title":"PoreFlow.compute_elasticity_tangent","text":"compute_elasticity_tangent(E::Float64, ν::Float64)\n\nComputes the elasticity matrix for 2D plane strain\n\n\n\n\n\n","category":"function"},{"location":"api/#PoreFlow.coupled_impose_pressure","page":"API","title":"PoreFlow.coupled_impose_pressure","text":"coupled_impose_pressure(A::SparseMatrixCSC{Float64,Int64}, pnode::Array{Int64}, \nm::Int64, n::Int64, h::Float64)\n\nReturns a trimmed matrix.\n\n\n\n\n\n","category":"function"},{"location":"coupled/#Coupled-Geomechanics-and-Single-Phase-Flow-1","page":"Coupled Geomechanics and Single Phase Flow","title":"Coupled Geomechanics and Single Phase Flow","text":"","category":"section"},{"location":"coupled/#Mathematical-Formulation-1","page":"Coupled Geomechanics and Single Phase Flow","title":"Mathematical Formulation","text":"","category":"section"},{"location":"coupled/#","page":"Coupled Geomechanics and Single Phase Flow","title":"Coupled Geomechanics and Single Phase Flow","text":"The governing equation for mechanical deformation of the solid-fluid system is ","category":"page"},{"location":"coupled/#","page":"Coupled Geomechanics and Single Phase Flow","title":"Coupled Geomechanics and Single Phase Flow","text":"boxedmathrmdiv sigma + rho_b g = 0","category":"page"},{"location":"coupled/#","page":"Coupled Geomechanics and Single Phase Flow","title":"Coupled Geomechanics and Single Phase Flow","text":"where mathrmdiv is the divergence operator, sigma is the Cauchy total-stress ","category":"page"},{"location":"coupled/#","page":"Coupled Geomechanics and Single Phase Flow","title":"Coupled Geomechanics and Single Phase Flow","text":"sigma = beginbmatrix\nsigma_xx  sigma_xy\nsigma_xy  sigma_yy\nendbmatrix","category":"page"},{"location":"coupled/#","page":"Coupled Geomechanics and Single Phase Flow","title":"Coupled Geomechanics and Single Phase Flow","text":"and ginmathbbR^2 is the gravity vector, rho_b=phi rho_f + (1-phi)rho_s  is the bulk density, rho_f is total fluid density, rho_s is the density of the solid phase and phi is the true porosity. ","category":"page"},{"location":"coupled/#","page":"Coupled Geomechanics and Single Phase Flow","title":"Coupled Geomechanics and Single Phase Flow","text":"The stress-strain relation for linear poroelasticity takes the form ","category":"page"},{"location":"coupled/#","page":"Coupled Geomechanics and Single Phase Flow","title":"Coupled Geomechanics and Single Phase Flow","text":"sigma = sigma - bpmathbfIquad sigma = beginbmatrix\nsigma_xx  sigma_xy\nsigma_xy  sigma_yy\nendbmatrix\nquadbeginbmatrix\ndeltasigma_xxdeltasigma_yydeltasigma_xy\nendbmatrix = Hbeginbmatrix\ndeltavarepsilon_xxdeltavarepsilon_yy2deltavarepsilon_xy\nendbmatrix","category":"page"},{"location":"coupled/#","page":"Coupled Geomechanics and Single Phase Flow","title":"Coupled Geomechanics and Single Phase Flow","text":"where mathbfI is the identity matrix, p is the pressure, b is the Biot coefficient, D is the elasticity matrix","category":"page"},{"location":"coupled/#","page":"Coupled Geomechanics and Single Phase Flow","title":"Coupled Geomechanics and Single Phase Flow","text":"H = fracE(1-nu^2)beginbmatrix\n1  nu 0\nnu  1  0\n0  0  1-nu\nendbmatrix","category":"page"},{"location":"coupled/#","page":"Coupled Geomechanics and Single Phase Flow","title":"Coupled Geomechanics and Single Phase Flow","text":"Here E is the Young modulus,  nu is the Poisson ratio and  varepsilon is the strain","category":"page"},{"location":"coupled/#","page":"Coupled Geomechanics and Single Phase Flow","title":"Coupled Geomechanics and Single Phase Flow","text":"varepsilon = beginbmatrix\nvarepsilon_xx  varepsilon_xy\nvarepsilon_xy  varepsilon_yy\nendbmatrix","category":"page"},{"location":"coupled/#","page":"Coupled Geomechanics and Single Phase Flow","title":"Coupled Geomechanics and Single Phase Flow","text":"info: Info\nThe relation between sigma and varepsilon may be nonlinear; that's why we only write delta sigma in terms of delta varepsilon. ","category":"page"},{"location":"coupled/#","page":"Coupled Geomechanics and Single Phase Flow","title":"Coupled Geomechanics and Single Phase Flow","text":"The fluid mass convervation in terms of pressure and volumetric strain is given by ","category":"page"},{"location":"coupled/#","page":"Coupled Geomechanics and Single Phase Flow","title":"Coupled Geomechanics and Single Phase Flow","text":"boxedfrac1Mfracpartial ppartial t + bfracpartial varepsilon_vpartial t + mathrmdivmathrmv = f","category":"page"},{"location":"coupled/#","page":"Coupled Geomechanics and Single Phase Flow","title":"Coupled Geomechanics and Single Phase Flow","text":"where varepsilon_v = mathrmtr varepsilon, f is a volumetric source term and ","category":"page"},{"location":"coupled/#","page":"Coupled Geomechanics and Single Phase Flow","title":"Coupled Geomechanics and Single Phase Flow","text":"mathbfv = -frac1B_ffrackmu(nabla p - rho_f g)","category":"page"},{"location":"coupled/#","page":"Coupled Geomechanics and Single Phase Flow","title":"Coupled Geomechanics and Single Phase Flow","text":"where k is the absolute permeability tensor, mu is the fluid viscosity and B_f is the formation volume factor of the fluid. ","category":"page"},{"location":"coupled/#","page":"Coupled Geomechanics and Single Phase Flow","title":"Coupled Geomechanics and Single Phase Flow","text":"The mechanical equation and fluid equation are coupled through p and varepsilon. In the drained split scheme, in each step p is kept fixed while solving the mechanics equation and then the fluid equation is solved keeping varepsilon fixed. The drained scheme can be viewed as a Jacobian iteration of the fully coupled system. ","category":"page"},{"location":"coupled/#","page":"Coupled Geomechanics and Single Phase Flow","title":"Coupled Geomechanics and Single Phase Flow","text":"note: Note\nThe linear poroelasticity equations with g=0 can be expressed as [linear]beginaligned\nmathrmdivsigma(u) - b nabla p = 0\nfrac1M fracpartial ppartial t + bfracpartial varepsilon_v(u)partial t - nablacdotleft(frackB_fmunabla pright) = f(xt)\nendaligned​with boundary conditionsbeginaligned\nsigma n = 0quad xin Gamma_N^u qquad u=0 quad xin Gamma_D^u\n-frackB_fmufracpartial ppartial n = 0quad xin Gamma_N^p qquad p=g quad xin Gamma_D^p\nendalignedand the initial conditionp(x0) = p_0 u(x0) =0 xin Omega","category":"page"},{"location":"coupled/#","page":"Coupled Geomechanics and Single Phase Flow","title":"Coupled Geomechanics and Single Phase Flow","text":"[linear]: Kolesov, Alexandr E., Petr N. Vabishchevich, and Maria V. Vasilyeva. \"Splitting schemes for poroelasticity and thermoelasticity problems.\" Computers & Mathematics with Applications 67.12 (2014): 2185-2198.","category":"page"},{"location":"coupled/#Numerical-Discretization-1","page":"Coupled Geomechanics and Single Phase Flow","title":"Numerical Discretization","text":"","category":"section"},{"location":"coupled/#Mechanics-1","page":"Coupled Geomechanics and Single Phase Flow","title":"Mechanics","text":"","category":"section"},{"location":"coupled/#","page":"Coupled Geomechanics and Single Phase Flow","title":"Coupled Geomechanics and Single Phase Flow","text":"We discretize the domain 0(n-1)htimes 0 (m-1)h uniformly with step size h.","category":"page"},{"location":"coupled/#","page":"Coupled Geomechanics and Single Phase Flow","title":"Coupled Geomechanics and Single Phase Flow","text":"(Image: )","category":"page"},{"location":"coupled/#","page":"Coupled Geomechanics and Single Phase Flow","title":"Coupled Geomechanics and Single Phase Flow","text":"The finite element method is usually used to solve the mechanics equation, whose discretization reads","category":"page"},{"location":"coupled/#","page":"Coupled Geomechanics and Single Phase Flow","title":"Coupled Geomechanics and Single Phase Flow","text":"int_Omega delta varepsilon sigmamathrmdx - int_Omega b p delta varepsilon_vmathrmdx = int_Gamma tcdotdelta umathrmds + int_Omega rho_b gcdotdelta u dx","category":"page"},{"location":"coupled/#","page":"Coupled Geomechanics and Single Phase Flow","title":"Coupled Geomechanics and Single Phase Flow","text":"where t = sigma n = sigma n - bpn, Gamma is the part of partial Omega with external traction,  and n is the unit normal vector pointing outwards. One each element A, define u_A as the nodal values of the basis functions whose supports overlap A, then the strain at (xy) can be expressed as (see the figure for illustration)","category":"page"},{"location":"coupled/#","page":"Coupled Geomechanics and Single Phase Flow","title":"Coupled Geomechanics and Single Phase Flow","text":"varepsilon_A = Bu_A quad varepsilon_A =beginbmatrix\nvarepsilon_xx\nvarepsilon_yy\n2varepsilon_xy\nendbmatrixquad\nu_A = beginbmatrix\nu_1\nu_2\nu_3\nu_4\nv_1\nv_2\nv_3\nv_4\nendbmatrix","category":"page"},{"location":"coupled/#","page":"Coupled Geomechanics and Single Phase Flow","title":"Coupled Geomechanics and Single Phase Flow","text":"where ","category":"page"},{"location":"coupled/#","page":"Coupled Geomechanics and Single Phase Flow","title":"Coupled Geomechanics and Single Phase Flow","text":"B = beginbmatrix\nfracpartial N_1partial x  fracpartial N_2partial x  fracpartial N_3partial x  fracpartial N_4partial x  0  0  0  0\n0  0  0  0  fracpartial N_1partial y  fracpartial N_2partial y  fracpartial N_3partial y  fracpartial N_4partial y\nfracpartial N_1partial y  fracpartial N_2partial y  fracpartial N_3partial y  fracpartial N_4partial y  fracpartial N_1partial x  fracpartial N_2partial x  fracpartial N_3partial x  fracpartial N_4partial x\nendbmatrix = beginbmatrix\n-frac1-etahfrac1-etah -fracetah  fracetah  0  0  0  0\n0  0  0  0  -frac1-xih  -fracxih  frac1-xih  fracxih\n-frac1-xih  -fracxih  frac1-xih  fracxih  -frac1-etahfrac1-etah -fracetah  fracetah\nendbmatrix","category":"page"},{"location":"coupled/#","page":"Coupled Geomechanics and Single Phase Flow","title":"Coupled Geomechanics and Single Phase Flow","text":"and","category":"page"},{"location":"coupled/#","page":"Coupled Geomechanics and Single Phase Flow","title":"Coupled Geomechanics and Single Phase Flow","text":"xi = fracx-x_0hquad eta = fracy-y_0h","category":"page"},{"location":"coupled/#","page":"Coupled Geomechanics and Single Phase Flow","title":"Coupled Geomechanics and Single Phase Flow","text":"(Image: )","category":"page"},{"location":"coupled/#","page":"Coupled Geomechanics and Single Phase Flow","title":"Coupled Geomechanics and Single Phase Flow","text":"The terms in the weak form can be expressed as ","category":"page"},{"location":"coupled/#","page":"Coupled Geomechanics and Single Phase Flow","title":"Coupled Geomechanics and Single Phase Flow","text":"int_Adelta varepsilon sigmamathrmdx = int_A u_AB^TDBdelta u_Amathrmdx","category":"page"},{"location":"coupled/#","page":"Coupled Geomechanics and Single Phase Flow","title":"Coupled Geomechanics and Single Phase Flow","text":"int_A b p delta varepsilon_vmathrmdx = int_A bp 110B^Tdelta u_Amathrmdx","category":"page"},{"location":"coupled/#","page":"Coupled Geomechanics and Single Phase Flow","title":"Coupled Geomechanics and Single Phase Flow","text":"Typically, the integration is computed using Gauss quadrature; for example, we have","category":"page"},{"location":"coupled/#","page":"Coupled Geomechanics and Single Phase Flow","title":"Coupled Geomechanics and Single Phase Flow","text":"int_A u_AB^TDBdelta u_Amathrmdx = u_A leftsum_i=1^n_g B(xi_i eta_i)^T DB(xi_i eta_i)h^2w_irightdelta u_A","category":"page"},{"location":"coupled/#","page":"Coupled Geomechanics and Single Phase Flow","title":"Coupled Geomechanics and Single Phase Flow","text":"where (x_i eta_i) are Gauss quadrature points and w_i is the corresponding weight. ","category":"page"},{"location":"coupled/#","page":"Coupled Geomechanics and Single Phase Flow","title":"Coupled Geomechanics and Single Phase Flow","text":"note: Note\nWe have the following convention for bdnode and bdedge, which denote the Dirichlet boundary conditions and the Neumann boundary conditions:bdnodein mathbfR^d and each entry in bdnode represents the node index. The corresponding row and column indices can be retrieved with femidx.\nbdedgein mathbfR^dtimes 2 and each row in bdedge represents indices of two end points of the edge. The corresponding cell row and column can be retrieved with fvmidx.","category":"page"},{"location":"coupled/#Fluid-1","page":"Coupled Geomechanics and Single Phase Flow","title":"Fluid","text":"","category":"section"},{"location":"coupled/#","page":"Coupled Geomechanics and Single Phase Flow","title":"Coupled Geomechanics and Single Phase Flow","text":"The fluid equation is discretized using finite volume method. ","category":"page"},{"location":"coupled/#","page":"Coupled Geomechanics and Single Phase Flow","title":"Coupled Geomechanics and Single Phase Flow","text":"int_A_i frac1Mfracp_i^n+1 - p_i^nDelta t mathrmdx + int_A_i b fracvarepsilon_v^n+1-varepsilon_v^nDelta t mathrmd x + int_A_i mathrmdivmathbfvmathrmdx = int_A_i fmathrmdx","category":"page"},{"location":"coupled/#","page":"Coupled Geomechanics and Single Phase Flow","title":"Coupled Geomechanics and Single Phase Flow","text":"For the divergence term, we use the two-point flux approximation and we have (assuming k is a constant scalar)","category":"page"},{"location":"coupled/#","page":"Coupled Geomechanics and Single Phase Flow","title":"Coupled Geomechanics and Single Phase Flow","text":"int_A_i mathrmdivmathbfv mathrmdx = -frackB_fmusum_j=1^n_mathrmfaces (q_j-q_i) = -frackB_fmusum_j=1^n_mathrmfaces (p_j^n+1 - p_i^n+1) + frackrho_fgB_fmusum_j=1^n_mathrmfaces (y_j-y_i)","category":"page"},{"location":"coupled/#","page":"Coupled Geomechanics and Single Phase Flow","title":"Coupled Geomechanics and Single Phase Flow","text":"where","category":"page"},{"location":"coupled/#","page":"Coupled Geomechanics and Single Phase Flow","title":"Coupled Geomechanics and Single Phase Flow","text":"q = p^n+1 - rho_fgy","category":"page"},{"location":"coupled/#Initial-and-Boundary-Conditions-1","page":"Coupled Geomechanics and Single Phase Flow","title":"Initial and Boundary Conditions","text":"","category":"section"},{"location":"coupled/#","page":"Coupled Geomechanics and Single Phase Flow","title":"Coupled Geomechanics and Single Phase Flow","text":"For the mechanial problem we consider","category":"page"},{"location":"coupled/#","page":"Coupled Geomechanics and Single Phase Flow","title":"Coupled Geomechanics and Single Phase Flow","text":"Prescribed displacement: u = bar u; or\nPrescribed traction: sigmacdot n=bar t (also called overburden).","category":"page"},{"location":"coupled/#","page":"Coupled Geomechanics and Single Phase Flow","title":"Coupled Geomechanics and Single Phase Flow","text":"For the flow problem we consider","category":"page"},{"location":"coupled/#","page":"Coupled Geomechanics and Single Phase Flow","title":"Coupled Geomechanics and Single Phase Flow","text":"Prescribed pressure: p=bar p; or\nPrescribed volumetric flux: mathbfvcdot n=bar v (called no flow if bar v=0).","category":"page"},{"location":"coupled/#","page":"Coupled Geomechanics and Single Phase Flow","title":"Coupled Geomechanics and Single Phase Flow","text":"The initial displacement and strains are zero. The initial pressure is prescribed. ","category":"page"},{"location":"coupled/#Verification-1","page":"Coupled Geomechanics and Single Phase Flow","title":"Verification","text":"","category":"section"},{"location":"coupled/#","page":"Coupled Geomechanics and Single Phase Flow","title":"Coupled Geomechanics and Single Phase Flow","text":"To verify our numerical scheme, we consider manufactured solution u(xy) = beginbmatrix x^2+y^2\nx^2-y^2 endbmatrixtquad p(xy) = x^2y^2(1-x)^2(1-y)^2e^-t","category":"page"},{"location":"coupled/#","page":"Coupled Geomechanics and Single Phase Flow","title":"Coupled Geomechanics and Single Phase Flow","text":"Then we have","category":"page"},{"location":"coupled/#","page":"Coupled Geomechanics and Single Phase Flow","title":"Coupled Geomechanics and Single Phase Flow","text":"beginaligned\nf(xyt)= (-x^2y^2(x - 1)^2(y - 1)^2 - 2x^2y^2(x - 1)^2 - 2x^2y^2(y - 1)^2 - 8x^2y(x - 1)^2(y - 1) - 2x^2(x - 1)^2(y - 1)^2 - 8xy^2(x - 1)(y - 1)^2 - 2y^2(x - 1)^2(y - 1)^2 + 2(x - y)exp(t))exp(-t)\ng(xyt)= beginbmatrix\n3t-2xe^-t\n-t + 2ye^-t\nendbmatrix\nendaligned","category":"page"},{"location":"coupled/#","page":"Coupled Geomechanics and Single Phase Flow","title":"Coupled Geomechanics and Single Phase Flow","text":"Description u displacement v displacement Pressure\nNumerical Result (Image: disp_u_out) (Image: disp_v_out) (Image: disp_p_out)\nError (Image: disp_u_diff) (Image: disp_v_diff) (Image: disp_p_diff)","category":"page"},{"location":"coupled/#","page":"Coupled Geomechanics and Single Phase Flow","title":"Coupled Geomechanics and Single Phase Flow","text":"Code","category":"page"},{"location":"coupled/#Benchmarks-1","page":"Coupled Geomechanics and Single Phase Flow","title":"Benchmarks","text":"","category":"section"},{"location":"coupled/#Flooding-1","page":"Coupled Geomechanics and Single Phase Flow","title":"Flooding","text":"","category":"section"},{"location":"coupled/#","page":"Coupled Geomechanics and Single Phase Flow","title":"Coupled Geomechanics and Single Phase Flow","text":"Code","category":"page"},{"location":"coupled/#","page":"Coupled Geomechanics and Single Phase Flow","title":"Coupled Geomechanics and Single Phase Flow","text":"u displacement v displacement Pressure\n(Image: disp_u_flood) (Image: disp_v_flood) (Image: disp_p_flood)","category":"page"},{"location":"coupled/#Injection-Production-in-Homogenious-Media-1","page":"Coupled Geomechanics and Single Phase Flow","title":"Injection-Production in Homogenious Media","text":"","category":"section"},{"location":"coupled/#","page":"Coupled Geomechanics and Single Phase Flow","title":"Coupled Geomechanics and Single Phase Flow","text":"Code","category":"page"},{"location":"coupled/#","page":"Coupled Geomechanics and Single Phase Flow","title":"Coupled Geomechanics and Single Phase Flow","text":"u displacement v displacement Pressure\n(Image: disp_u_flood) (Image: disp_v_flood) (Image: disp_p_flood)","category":"page"},{"location":"coupled/#Injection-Production-in-Homogenious-Media-and-with-J2-plasticity-1","page":"Coupled Geomechanics and Single Phase Flow","title":"Injection-Production in Homogenious Media and with J2 plasticity","text":"","category":"section"},{"location":"coupled/#","page":"Coupled Geomechanics and Single Phase Flow","title":"Coupled Geomechanics and Single Phase Flow","text":"Code","category":"page"},{"location":"coupled/#","page":"Coupled Geomechanics and Single Phase Flow","title":"Coupled Geomechanics and Single Phase Flow","text":"Description u displacement v displacement Pressure\nK = 05 sigma_Y = 03 (Image: ) (Image: ) (Image: )\nK = 0 sigma_Y = 03 (Image: ) (Image: ) (Image: )\nK = 05 sigma_Y = 10 (Image: ) (Image: ) (Image: )","category":"page"},{"location":"coupled/#Injection-Production-in-Heterogenious-Media-1","page":"Coupled Geomechanics and Single Phase Flow","title":"Injection-Production in Heterogenious Media","text":"","category":"section"},{"location":"coupled/#","page":"Coupled Geomechanics and Single Phase Flow","title":"Coupled Geomechanics and Single Phase Flow","text":"Code","category":"page"},{"location":"coupled/#","page":"Coupled Geomechanics and Single Phase Flow","title":"Coupled Geomechanics and Single Phase Flow","text":"u displacement v displacement Pressure\n(Image: disp_u_flood) (Image: disp_v_flood) (Image: disp_p_flood)","category":"page"},{"location":"plasticity/#Plasticity-1","page":"Plasticity","title":"Plasticity","text":"","category":"section"},{"location":"plasticity/#Plasticity-Theory-1","page":"Plasticity","title":"Plasticity Theory","text":"","category":"section"},{"location":"plasticity/#","page":"Plasticity","title":"Plasticity","text":"The constitutive theory is about relating stress sigma and strain varepsilon. ","category":"page"},{"location":"plasticity/#","page":"Plasticity","title":"Plasticity","text":"The total strain varepsilon can be decomposed into ","category":"page"},{"location":"plasticity/#","page":"Plasticity","title":"Plasticity","text":"varepsilon = varepsilon^p + varepsilon^e","category":"page"},{"location":"plasticity/#","page":"Plasticity","title":"Plasticity","text":"The constitutive relation must characterize the relation between the stress varepsilon for both varepsilon^p and varepsilon^e . The constitutive law for varepsilon^e is linear, i.e., ","category":"page"},{"location":"plasticity/#","page":"Plasticity","title":"Plasticity","text":"sigma = Cvarepsilon^eLeftrightarrowvarepsilon^e = C^-1sigma","category":"page"},{"location":"plasticity/#","page":"Plasticity","title":"Plasticity","text":"The constitutive law for varepsilon^p is described by an ordinary differential equation ","category":"page"},{"location":"plasticity/#","page":"Plasticity","title":"Plasticity","text":"boxeddotvarepsilon^p_ij = phi h_ijtag1","category":"page"},{"location":"plasticity/#","page":"Plasticity","title":"Plasticity","text":"Here h_ij may arise from a potential function g(sigma xi), where xi is called internal variables","category":"page"},{"location":"plasticity/#","page":"Plasticity","title":"Plasticity","text":"h_ij = fracpartial gpartial sigma_ij","category":"page"},{"location":"plasticity/#","page":"Plasticity","title":"Plasticity","text":"and phi is a scalar function of the form ","category":"page"},{"location":"plasticity/#","page":"Plasticity","title":"Plasticity","text":"phi = eta(sigmaxi) f(sigma xi)_+ = eta(sigmaxi)max(0 f(sigma xi))","category":"page"},{"location":"plasticity/#","page":"Plasticity","title":"Plasticity","text":"where f is the yield surface. ","category":"page"},{"location":"plasticity/#","page":"Plasticity","title":"Plasticity","text":"example: Example\nThe Tresca yield surface is given by f(sigma xi) = frac14(sigma_1-sigma_2+sigma_2-sigma_3+sigma_3-sigma_1)-k(xi)","category":"page"},{"location":"plasticity/#","page":"Plasticity","title":"Plasticity","text":"example: Example\n​In J_2 plasticity, we haveg(sigma xi) = J_2(sigma) - k(xi)^2​Thus we havedotvarepsilon^p_ij = mathrmconsttimesleft(1-frack(xi)J_2(sigma)right)_+ s_ij(Image: )","category":"page"},{"location":"plasticity/#","page":"Plasticity","title":"Plasticity","text":"In the rate-indpendent plasticity, there exists lambda such that ","category":"page"},{"location":"plasticity/#","page":"Plasticity","title":"Plasticity","text":"phi = dotlambda","category":"page"},{"location":"plasticity/#","page":"Plasticity","title":"Plasticity","text":"Since both sides of (1) has derivatives with respect to time, it is time scale independent. That's why we call it rate-independent. Then the flow rule requires that ","category":"page"},{"location":"plasticity/#","page":"Plasticity","title":"Plasticity","text":"boxeddot lambda f = 0quad lambdageq 0quad fleq 0tag2","category":"page"},{"location":"plasticity/#","page":"Plasticity","title":"Plasticity","text":"If f0 (the yield surface is not hit), the inelasticity strain is not \"active\"; once f=0 is hit, the material reacts by increasing plasticity strain (since dot lambda can be nonzero). ","category":"page"},{"location":"plasticity/#","page":"Plasticity","title":"Plasticity","text":"The deformation theory studies how g is related to sigma and xi. If h directs along the outward normal of the yield surface, we can the consequent g the normality rule.  For example, J_2 plasticity can be formulated is subjected to normality rule. A particular case where normality rule holds is g=f, in which case we call (1) the associated flow rule with the yield surface.","category":"page"},{"location":"plasticity/#","page":"Plasticity","title":"Plasticity","text":"Finally, the dynamics of internal variable is given by ","category":"page"},{"location":"plasticity/#","page":"Plasticity","title":"Plasticity","text":"boxeddotxi_alpha = tilde h_alpha(sigma xi)tag3","category":"page"},{"location":"plasticity/#","page":"Plasticity","title":"Plasticity","text":"The three equations (1), (2) and (3) fully characterizes the constitutive relation of varepsilon^p.","category":"page"},{"location":"plasticity/#Code-Example-1","page":"Plasticity","title":"Code Example","text":"","category":"section"},{"location":"plasticity/#","page":"Plasticity","title":"Plasticity","text":"Description Displacement Field Vertical Displacement\nPlasticity (Image: ) (Image: )\nElasticity (Image: ) (Image: )","category":"page"},{"location":"plasticity/#","page":"Plasticity","title":"Plasticity","text":"using Revise\nusing PoreFlow\nusing SparseArrays\nusing LinearAlgebra\nusing PyPlot\nαm = 0.0\nαf = 0.0\nβ2 = 0.5*(1 - αm + αf)^2\nγ = 0.5 - αm + αf\n\nm = 40\nn = 20\nh = 0.01\nNT = 100\nΔt = 1/NT \nbdedge = []\nfor j = 1:n \n    push!(bdedge, [(j-1)*(m+1)+m+1 j*(m+1)+m+1])\nend\nbdedge = vcat(bdedge...)\n\nbdnode = Int64[]\nfor j = 1:n+1\n    push!(bdnode, (j-1)*(m+1)+1)\nend\n\nM = compute_fem_mass_matrix1(m, n, h)\nS = spzeros((m+1)*(n+1), (m+1)*(n+1))\nM = [M S;S M]\nH = diagm(0=>[1,1,0.5])\nK = 0.1\nσY = 0.03\n# σY = 1000.\n\n\nstate = zeros(2(m+1)*(n+1),NT+1)\nvelo = zeros(2(m+1)*(n+1),NT+1)\nacce = zeros(2(m+1)*(n+1),NT+1)\nstress = zeros(NT+1, 4*m*n, 3)\ninternal_variable = zeros(NT+1, 4*m*n)\n\nt = 0.0\nfor i = 1:NT \n    @info i \n        ##### STEP 1: Computes the external force ####\n\n    T = eval_f_on_boundary_edge((x,y)->0.02*sin(2π*i*Δt), bdedge, m, n, h)\n    # T = eval_f_on_boundary_edge((x,y)->0.0, bdedge, m, n, h)\n    T = [zeros(length(T)) -T]\n    T = compute_fem_traction_term(T, bdedge, m, n, h)\n    f1 = eval_f_on_gauss_pts((x,y)->0., m, n, h)\n    f2 = eval_f_on_gauss_pts((x,y)->0., m, n, h)\n    # f2 = eval_f_on_gauss_pts((x,y)->0.1, m, n, h)\n    F = compute_fem_source_term(f1, f2, m, n, h)\n    fext = F+T\n\n        ##### STEP 2: Extract Variables ####\n\n    u = state[:,i]\n    ∂∂u = acce[:,i]\n    ∂u = velo[:,i]\n\n    ε0 = eval_strain_on_gauss_pts(u, m, n, h)\n    σ0 = stress[i,:,:]\n    α0 = internal_variable[i,:]\n    \n        ##### STEP 3: Newton Iteration ####\n\n    global t += (1 - αf)*Δt\n    ∂∂up = ∂∂u[:]\n    iter = 0\n    while true\n        iter += 1\n        # @info iter\n        up = (1 - αf)*(u + Δt*∂u + 0.5 * Δt^2 * ((1 - β2)*∂∂u + β2*∂∂up)) + αf*u\n        global fint, stiff, α, σ = compute_planestressplasticity_stress_and_stiffness_matrix(\n            up, ε0, σ0, α0, K, σY, H, m, n, h\n        )\n        res = M * (∂∂up *(1 - αm) + αm*∂∂u)  + fint - fext\n        A = M*(1 - αm) + (1 - αf) * 0.5 * β2 * Δt^2 * stiff\n        A, _ = fem_impose_Dirichlet_boundary_condition(A, bdnode, m, n, h)\n        res[[bdnode; bdnode .+ (m+1)*(n+1)]] .= 0.0\n\n        Δ∂∂u = A\\res\n        ∂∂up -= Δ∂∂u\n        err = norm(res)\n        # @info err\n        if err<1e-8\n            break \n        end\n    end\n    global t += αf*Δt\n    \n        ##### STEP 3: Update State Variables ####\n\n    u += Δt * ∂u + Δt^2/2 * ((1 - β2) * ∂∂u + β2 * ∂∂up)\n    ∂u += Δt * ((1 - γ) * ∂∂u + γ * ∂∂up)\n    stress[i+1,:,:] = σ\n    internal_variable[i+1,:] = α\n    \n    state[:,i+1] = u\n    acce[:,i+1] = ∂∂up\n    velo[:,i+1] = ∂u\nend\n\nx = []\ny = []\nfor j= 1:n+1\n    for i = 1:m+1\n        push!(x, (i-1)*h)\n        push!(y, (j-1)*h)\n    end\nend\n\nfor i = 1:5:NT+1\n    close(\"all\")\n    scatter(x+state[1:(m+1)*(n+1), i], y+state[(m+1)*(n+1)+1:end, i])\n    scatter(x[m+1]+state[m+1, i],\n            y[m+1]+state[(m+1)*(n+1)+m+1, i], color=\"red\")\n    xlabel(\"x\")\n    ylabel(\"y\")\n    k = string(i)\n    k = repeat(\"0\", 3-length(k))*k \n    title(\"t = $k\")\n    ylim(-0.05,0.25)\n    xlim(-0.01, 0.45)\n    gca().invert_yaxis()\n    savefig(\"u$k.png\")\n\n    close(\"all\"); \n    plot(1:i, -state[(m+1)*(n+1)+m+1, 1:i])\n    xlim(0, NT+2)\n    ylim(0, 0.03)\n    scatter(i, -state[(m+1)*(n+1)+m+1, i], color=\"red\")\n    savefig(\"du$k.png\")\nend\n\nrun(`convert -delay 10 -loop 0 u*.png plasticity_u.gif`)\nrun(`convert -delay 10 -loop 0 du*.png plasticity_du.gif`)\n\n","category":"page"},{"location":"elastodynamics/#Elastodynamics-1","page":"Elastodynamics","title":"Elastodynamics","text":"","category":"section"},{"location":"elastodynamics/#","page":"Elastodynamics","title":"Elastodynamics","text":"The governing equation for elastodynamics is ","category":"page"},{"location":"elastodynamics/#","page":"Elastodynamics","title":"Elastodynamics","text":"beginaligned\nfracpartial^2 upartial t^2 = mathrmdivsigma + f Omegatimes 0T\nsigma n = t  Gamma_Ntimes 0T\nu = u_0  Gamma_Dtimes0T\nendaligned","category":"page"},{"location":"elastodynamics/#","page":"Elastodynamics","title":"Elastodynamics","text":"The constitutive law is given by ","category":"page"},{"location":"elastodynamics/#","page":"Elastodynamics","title":"Elastodynamics","text":"sigma = Cvarepsilon","category":"page"},{"location":"elastodynamics/#","page":"Elastodynamics","title":"Elastodynamics","text":"We fix the left side of the plate. We use the alpha method [alpha].","category":"page"},{"location":"elastodynamics/#","page":"Elastodynamics","title":"Elastodynamics","text":"[alpha]: Hughes, Thomas JR. The finite element method: linear static and dynamic finite element analysis. Courier Corporation, 2012. ","category":"page"},{"location":"elastodynamics/#","page":"Elastodynamics","title":"Elastodynamics","text":"Gravity External Force\n(Image: ) (Image: )","category":"page"},{"location":"elastodynamics/#","page":"Elastodynamics","title":"Elastodynamics","text":"β = 1/4; γ = 1/2\na = b = 0.1\nm = 40\nn = 20\nh = 0.01\nNT = 200\nΔt = 1/NT \nbdedge = []\nfor j = 1:n \n  push!(bdedge, [(j-1)*(m+1)+m+1 j*(m+1)+m+1])\nend\nbdedge = vcat(bdedge...)\n\nbdnode = Int64[]\nfor j = 1:n+1\n  push!(bdnode, (j-1)*(m+1)+1)\nend\n\nM = compute_fem_mass_matrix1(m, n, h)\nS = spzeros((m+1)*(n+1), (m+1)*(n+1))\nM = [M S;S M]\n\nK = compute_fem_stiffness_matrix(D, m, n, h)\nC = a*M + b*K # damping matrix \n\nL = M + γ*Δt*C + β*Δt^2*K\nL, Lbd = fem_impose_Dirichlet_boundary_condition(L, bdnode, m, n, h)\n\na = zeros(2(m+1)*(n+1))\nv = zeros(2(m+1)*(n+1))\nd = zeros(2(m+1)*(n+1))\nU = zeros(2(m+1)*(n+1),NT+1)\nfor i = 1:NT \n  T = eval_f_on_boundary_edge((x,y)->0.01, bdedge, m, n, h)\n  # T = eval_f_on_boundary_edge((x,y)->0.0, bdedge, m, n, h)\n  T = [zeros(length(T)) -T]\n  T = compute_fem_traction_term(T, bdedge, m, n, h)\n  f1 = eval_f_on_gauss_pts((x,y)->0., m, n, h)\n  f2 = eval_f_on_gauss_pts((x,y)->0., m, n, h)\n  # f2 = eval_f_on_gauss_pts((x,y)->0.1, m, n, h)\n  F = compute_fem_source_term(f1, f2, m, n, h)\n\n  rhs = F+T\n\n  td = d + Δt*v + Δt^2/2*(1-2β)*a \n  tv = v + (1-γ)*Δt*a \n  rhs = rhs - C*tv - K*td\n  rhs[[bdnode; bdnode.+(m+1)*(n+1)]] .= 0.0\n\n  a = L\\rhs \n  d = td + β*Δt^2*a \n  v = tv + γ*Δt*a \n  U[:,i+1] = d\nend\n\nx = []\ny = []\nfor j= 1:n+1\n  for i = 1:m+1\n    push!(x, (i-1)*h)\n    push!(y, (j-1)*h)\n  end\nend\nfor i = 1:10:NT+1\n  close(\"all\")\n  scatter(x+U[1:(m+1)*(n+1), i], y+U[(m+1)*(n+1)+1:end, i])\n  xlabel(\"x\")\n  ylabel(\"y\")\n  k = string(i)\n  k = repeat(\"0\", 3-length(k))*k \n  title(\"t = $k\")\n  ylim(-0.05,0.25)\n  gca().invert_yaxis()\n  savefig(\"u$k.png\")\nend","category":"page"},{"location":"heatequation/#Heat-Equation-1","page":"Heat Equation","title":"Heat Equation","text":"","category":"section"},{"location":"heatequation/#","page":"Heat Equation","title":"Heat Equation","text":"The strong form of the initial/boundary-value problem of the heat equation is: given f, u_0, q, find ubarOmegatimes 0Trightarrow mathbbR such that","category":"page"},{"location":"heatequation/#","page":"Heat Equation","title":"Heat Equation","text":"beginaligned\nrhofracpartial upartial t - nablacdot(Knabla u) = f Omegatimes (0T)\nu = u_0  Gamma_Dtimes (0T)\nKfracpartial upartial n = q Gamma_Ntimes (0T)\nendaligned","category":"page"},{"location":"heatequation/#","page":"Heat Equation","title":"Heat Equation","text":"The corresponding weak form is: given f, u_0 and q , find u, such that for all w","category":"page"},{"location":"heatequation/#","page":"Heat Equation","title":"Heat Equation","text":"int_Omega rhofracpartial upartial tdelta u mathrmdx + int_Omega Knabla u cdot nabla delta u mathrmd x = int_Omega fdelta u mathrmd x + int_Gamma_N q delta u mathrmdx","category":"page"},{"location":"heatequation/#","page":"Heat Equation","title":"Heat Equation","text":"The computational domain is as follows: the top side is the inflow boundary condition and the other sides are Dirichlet boundary condition. ","category":"page"},{"location":"heatequation/#","page":"Heat Equation","title":"Heat Equation","text":"(Image: )","category":"page"},{"location":"heatequation/#","page":"Heat Equation","title":"Heat Equation","text":"We consider the manufactured solution ","category":"page"},{"location":"heatequation/#","page":"Heat Equation","title":"Heat Equation","text":"u(x t) = (x_1^2+x_2^2)e^-tquad rho(x) = (1+x_1^2+x_2^2)","category":"page"},{"location":"heatequation/#","page":"Heat Equation","title":"Heat Equation","text":"and ","category":"page"},{"location":"heatequation/#","page":"Heat Equation","title":"Heat Equation","text":"K = beginbmatrix\n2  1 \n1  2\nendbmatrix","category":"page"},{"location":"heatequation/#","page":"Heat Equation","title":"Heat Equation","text":"Then we have","category":"page"},{"location":"heatequation/#","page":"Heat Equation","title":"Heat Equation","text":"beginaligned\nf(x) = -(1+x_1^2+x_2^2)(x_1^2+x_2^2) e^-t - 8 e^-t\nq(x) = -(2x+4y)e^-t\nendaligned","category":"page"},{"location":"heatequation/#","page":"Heat Equation","title":"Heat Equation","text":"m = 40\nn = 20\nh = 0.01\nbdedge = []\nfor i = 1:m \n  push!(bdedge, [i i+1])\nend\nbdedge = vcat(bdedge...)\n\nbdnode = Int64[]\nfor j = 1:n+1\n  push!(bdnode, (j-1)*(m+1)+1)\n  push!(bdnode, (j-1)*(m+1)+m+1)\nend\nfor i = 2:m\n  push!(bdnode, n*(m+1)+i)\nend\n\nρ = eval_f_on_gauss_pts((x,y)->1+x^2+y^2, m, n, h)\nM = compute_fem_mass_matrix1(ρ, m, n, h)\n\nK_ = [2.0 1.0\n  1.0 2.0]\nK = compute_fem_stiffness_matrix1(K_, m, n, h)\n\nNT = 200\nΔt = 1/NT \nA = M/Δt+K \nA, Abd = fem_impose_Dirichlet_boundary_condition1(A, bdnode, m, n, h)\nU = zeros((m+1)*(n+1), NT+1)\nfor i = 1:m+1\n  for j = 1:n+1\n    x = (i-1)*h; y = (j-1)*h \n    U[(j-1)*(m+1)+i, 1] = x^2+y^2\n  end\nend\nfor i = 1:NT \n  F = eval_f_on_gauss_pts((x,y)->(-(1+x^2+y^2)*(x^2+y^2)-8)*exp(-i*Δt), m, n, h)\n  F = compute_fem_source_term1(F, m, n, h)\n\n  T = eval_f_on_boundary_edge((x,y)->-(2*x+4*y)*exp(-i*Δt), bdedge, m, n, h)\n  T = compute_fem_flux_term1(T, bdedge, m, n, h)\n\n  rhs = F  + M*U[:,i]/Δt + T\n  bdval = eval_f_on_boundary_node( (x,y)->(x^2+y^2)*exp(-i*Δt), bdnode, m, n, h)\n  rhs[bdnode] = bdval\n  U[:,i+1] = A\\(\n    rhs - Abd*bdval\n  )\nend\n\nUexact = zeros(n+1,m+1)\nfor j = 1:n+1\n  for i = 1:m+1\n    x = (i-1)*h; y = (j-1)*h \n    Uexact[j, i] = (x^2+y^2)*exp(-1)\n  end\nend\npcolormesh(reshape(U[:,end], m+1, n+1)'-Uexact); colorbar()","category":"page"},{"location":"heatequation/#","page":"Heat Equation","title":"Heat Equation","text":"(Image: )","category":"page"}]
}
