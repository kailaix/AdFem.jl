<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Unstructured Meshes in AdFem · AdFem</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.png" alt="AdFem logo"/></a><div class="docs-package-name"><span class="docs-autofit">AdFem</span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">AdFem.jl Documentation</a></li><li><span class="tocitem">Tutorial</span><ul><li><a class="tocitem" href="../gallery/">PDE Galleries</a></li></ul></li><li><span class="tocitem">Forward Computation</span><ul><li><a class="tocitem" href="../coupled/">Coupled Geomechanics and Single Phase Flow</a></li><li><a class="tocitem" href="../staticelasticity/">Static Linear Elasticity</a></li><li><a class="tocitem" href="../plasticity/">Plasticity</a></li><li><a class="tocitem" href="../viscoelasticity/">Viscoelasticity</a></li><li><a class="tocitem" href="../viscoelasticity_earth/">Modeling Viscoelasticity of the Earth</a></li><li><a class="tocitem" href="../earthquake/">Earthquake Simulation with Rate-and-State Friction</a></li><li><a class="tocitem" href="../heatequation/">Heat Equation</a></li><li><a class="tocitem" href="../elastodynamics/">Elastodynamics</a></li><li><a class="tocitem" href="../twophaseflow/">Coupled Geomechanics and Multiphase Flow</a></li><li><a class="tocitem" href="../NavierStokes2/">Navier-Stokes equations</a></li><li><a class="tocitem" href="../SteadyStateNavierStokes/">Steady-state Navier-Stokes equations</a></li><li><a class="tocitem" href="../CHTCoupled/">Conjugate heat transfer coupled solver for incompressible fluid</a></li><li><a class="tocitem" href="../fwd_mixed_poisson/">Mixed Finite Element Methods for Poisson&#39;s Equation</a></li><li><a class="tocitem" href="../fwd_linear_elasticity/">Mixed Finite Element Methods for Linear Elasticity</a></li><li><a class="tocitem" href="../fwd_stress_based_viscoelasticity/">Mixed Finite Element Methods for Linear Viscoelasticity</a></li></ul></li><li><span class="tocitem">Inverse Modeling</span><ul><li><a class="tocitem" href="../inverse/">Inverse Modeling for Poroelasticity Models</a></li><li><a class="tocitem" href="../inv_viscoelasticity/">Inverse Modeling for Space Varying Viscoelasticity</a></li><li><a class="tocitem" href="../coupled_viscoelasticity/">Coupled Viscoelasticity and Single Phase Flow</a></li><li><a class="tocitem" href="../inv_twophaseflow/">Coupled Geomechanics and Multiphase Flow</a></li><li><a class="tocitem" href="../inv_viscoelasticity_nonparametric/">Inverse Modeling for Nonparametric Viscoelasticity</a></li><li><a class="tocitem" href="../inv_viscoelasticity_earth/">Viscoelasticity Model for the Earth</a></li></ul></li><li><span class="tocitem">Advanced Topics</span><ul><li class="is-active"><a class="tocitem" href>Unstructured Meshes in AdFem</a></li><li><a class="tocitem" href="../mfem_mesh/">Construct Unstructured Meshes for AdFem</a></li><li><a class="tocitem" href="../dev_unstructured/">Adding Custom Operators for Unstructured Meshes</a></li><li><a class="tocitem" href="../BDMElement/">BDM Finite Element</a></li><li><a class="tocitem" href="../mfem3d/">Working with 3D Domains</a></li></ul></li><li><a class="tocitem" href="../api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Advanced Topics</a></li><li class="is-active"><a href>Unstructured Meshes in AdFem</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Unstructured Meshes in AdFem</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/kailaix/AdFem.jl/blob/master/docs/src/mfem_tutorial.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Unstructured-Meshes-in-AdFem"><a class="docs-heading-anchor" href="#Unstructured-Meshes-in-AdFem">Unstructured Meshes in AdFem</a><a id="Unstructured-Meshes-in-AdFem-1"></a><a class="docs-heading-anchor-permalink" href="#Unstructured-Meshes-in-AdFem" title="Permalink"></a></h1><p>AdFem.jl also provides unstructured mesh support by leveraging <a href="https://mfem.org/">MFEM</a> as the finite element backend. </p><p>The APIs are designed such that they are consistent with structured meshes. For most of the functions, we only need to replace geometry parameters <code>m, n, h</code> with <code>mesh</code>, which is a <a href="../api/#AdFem.Mesh"><code>Mesh</code></a> instance. The triangular elements are the default in the AdFem unstructured mesh module.  <code>Mesh</code> can be constructed using a <span>$N\times 2$</span> node vector and a <span>$E\times 3$</span> element vector (<strong>1-based</strong>); for example:</p><pre><code class="language-julia">nodes = [0.0 0.0;1.0 0.0;0.0 1.0;1.0 1.0]
elems = [1 2 3;2 3 4]
mesh = Mesh(nodes, elems)</code></pre><p>Particularly, we provide a convenient constructor for constructing meshes on a rectangle: </p><pre><code class="language-julia">mesh = Mesh(m, n, h)
visualize_mesh(mesh)</code></pre><p><img src="https://raw.githubusercontent.com/ADCMEMarket/ADCMEImages/master/AdFem/mfem/mfem_mesh.png" alt/> Because we do not use the static condensation technique for tackling boundary conditions, there is no need to specify boundary conditions at this point. Plus, the lack of boundary conditions make it easier to develope re-usable custom operators for the finite element method. </p><p>The following script shows how to use an unstructured mesh to solve the Poisson equation <a href="https://kailaix.github.io/AdFem.jl/dev/gallery/#Poisson&#39;s-Equation">here</a></p><pre><code class="language-julia">using PyPlot 
using AdFem

m = 50; n = 50; h = 1/n 
mesh = Mesh(m, n, h)
kappa = constant(ones(get_ngauss(mesh)))
A = compute_fem_laplace_matrix1(kappa, mesh)
F = constant(eval_f_on_gauss_pts((x,y)-&gt;2π^2*sin(π*x)*sin(π*y), mesh))

bd = Int64[]
for j = 1:m+1
    push!(bd, j)
    push!(bd, n*(m+1)+j)
end
for i = 2:n
    push!(bd, (i-1)*(m+1)+1)
    push!(bd, (i-1)*(m+1)+m+1)
end

A, _ = fem_impose_Dirichlet_boundary_condition1(A, bd, mesh)
rhs = compute_fem_source_term1(F, mesh)
rhs = scatter_update(rhs, bd, zeros(length(bd)))
sol = A\rhs

sess = Session(); init(sess)
S = run(sess, sol)

figure(figsize=(10,4))
subplot(121)
visualize_scalar_on_fem_points(S, mesh)
title(&quot;Computed&quot;)
subplot(122)
visualize_scalar_on_fem_points(eval_f_on_fem_pts((x,y)-&gt;sin(π*x)*sin(π*y), mesh), mesh)
title(&quot;Reference&quot;)</code></pre><p><img src="https://raw.githubusercontent.com/ADCMEMarket/ADCMEImages/master/AdFem/mfem/poisson.png" alt/></p><p>As a more interesting example, we consider the domain with two holes. Here we let the right hand side be 1. We impose Dirichlet boundary conditions on the bounding box and Neumann boundary conditions around the disc boundaries. </p><pre><code class="language-julia">using PyPlot 
using AdFem

mesh = Mesh(&quot;twoholes.msh&quot;)

kappa = constant(ones(get_ngauss(mesh)))
A = compute_fem_laplace_matrix1(kappa, mesh)
F = constant(eval_f_on_gauss_pts((x,y)-&gt;1.0, mesh))

bd = Int64[]
for i = 1:size(mesh.nodes, 1)
    x = mesh.nodes[i,1]
    y = mesh.nodes[i,2]
    if abs(x-0.049)&lt;1e-5 || abs(x)&lt;1e-5 || abs(y)&lt;1e-5 || abs(y-0.023)&lt;1e-5
        push!(bd, i)
    end
end

A, _ = fem_impose_Dirichlet_boundary_condition1(A, bd, mesh)
rhs = compute_fem_source_term1(F, mesh)
rhs = scatter_update(rhs, bd, zeros(length(bd)))
sol = A\rhs

sess = Session(); init(sess)
S = run(sess, sol)

visualize_scalar_on_fem_points(S, mesh)
savefig(&quot;uPoisson.png&quot;)</code></pre><p><img src="https://raw.githubusercontent.com/ADCMEMarket/ADCMEImages/master/AdFem/mfem/uPoisson.png" alt/></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../inv_viscoelasticity_earth/">« Viscoelasticity Model for the Earth</a><a class="docs-footer-nextpage" href="../mfem_mesh/">Construct Unstructured Meshes for AdFem »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Wednesday 9 December 2020 10:53">Wednesday 9 December 2020</span>. Using Julia version 1.4.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
