<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>PoreFlow.jl Documentation · PoreFlow</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">PoreFlow</span></div><form class="docs-search" action="search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>PoreFlow.jl Documentation</a><ul class="internal"><li><a class="tocitem" href="#Expressing-Numerical-Simulation-as-a-Computational-Graph"><span>Expressing Numerical Simulation as a Computational Graph</span></a></li><li><a class="tocitem" href="#Coupling-Deep-Neural-Networks-and-PDEs"><span>Coupling Deep Neural Networks and PDEs</span></a></li><li><a class="tocitem" href="#Installation"><span>Installation</span></a></li></ul></li><li><a class="tocitem" href="gallery/">PDE Galleries</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="coupled/">Coupled Geomechanics and Single Phase Flow</a></li><li><a class="tocitem" href="staticelasticity/">Static Linear Elasticity</a></li><li><a class="tocitem" href="plasticity/">Plasticity</a></li><li><a class="tocitem" href="viscoelasticity/">Viscoelasticity</a></li><li><a class="tocitem" href="viscoelasticity_earth/">Modeling Viscoelasticity of the Earth</a></li><li><a class="tocitem" href="earthquake/">Earthquake Simulation with Rate-and-State Friction</a></li><li><a class="tocitem" href="heatequation/">Heat Equation</a></li><li><a class="tocitem" href="elastodynamics/">Elastodynamics</a></li><li><a class="tocitem" href="twophaseflow/">Coupled Geomechanics and Multiphase Flow</a></li><li><a class="tocitem" href="NavierStokes2/">Navier-Stokes equations</a></li><li><a class="tocitem" href="SteadyStateNavierStokes/">Steady-state Navier-Stokes equations</a></li><li><a class="tocitem" href="CHTCoupled/">Conjugate heat transfer coupled solver for incompressible fluid</a></li></ul></li><li><span class="tocitem">Inverse Modeling</span><ul><li><a class="tocitem" href="inverse/">Inverse Modeling for Poroelasticity Models</a></li><li><a class="tocitem" href="inv_viscoelasticity/">Inverse Modeling for Space Varying Viscoelasticity</a></li><li><a class="tocitem" href="coupled_viscoelasticity/">Coupled Viscoelasticity and Single Phase Flow</a></li><li><a class="tocitem" href="inv_twophaseflow/">Coupled Geomechanics and Multiphase Flow</a></li><li><a class="tocitem" href="inv_viscoelasticity_nonparametric/">Inverse Modeling for Nonparametric Viscoelasticity</a></li><li><a class="tocitem" href="inv_viscoelasticity_earth/">Viscoelasticity Model for the Earth</a></li></ul></li><li><span class="tocitem">Unstructured Mesh</span><ul><li><a class="tocitem" href="mfem_tutorial/">Unstructured Meshes in PoreFlow</a></li><li><a class="tocitem" href="mfem_mesh/">Construct Unstructured Meshes for PoreFlow</a></li><li><a class="tocitem" href="dev_unstructured/">Adding Custom Operators for Unstructured Meshes</a></li></ul></li><li><a class="tocitem" href="api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>PoreFlow.jl Documentation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>PoreFlow.jl Documentation</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/kailaix/PoreFlow.jl/blob/master/docs/src/index.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="PoreFlow.jl-Documentation"><a class="docs-heading-anchor" href="#PoreFlow.jl-Documentation">PoreFlow.jl Documentation</a><a id="PoreFlow.jl-Documentation-1"></a><a class="docs-heading-anchor-permalink" href="#PoreFlow.jl-Documentation" title="Permalink"></a></h1><p>PoreFlow is an open-source package that accompanies <a href="https://github.com/kailaix/ADCME.jl">ADCME.jl</a> for solving inverse problems involving partial differential equations (PDEs). PoreFlow provides users a rich collection of operators, which users can use to quickly build finite element/volumn codes for forward computation. More importantly, these operators can back-propagate gradients, and therefore users can calculate the gradients using the ideas of adjoint methods and reverse-mode automatic differention (these two concepts overlap). The advanced physics constrained learning (PCL) approach enables users to back-propagate gradients through iterative and nonlinear solvers efficiently. PoreFlow offers a flexible interface for experienced researchers to develop their own operators. </p><h2 id="Expressing-Numerical-Simulation-as-a-Computational-Graph"><a class="docs-heading-anchor" href="#Expressing-Numerical-Simulation-as-a-Computational-Graph">Expressing Numerical Simulation as a Computational Graph</a><a id="Expressing-Numerical-Simulation-as-a-Computational-Graph-1"></a><a class="docs-heading-anchor-permalink" href="#Expressing-Numerical-Simulation-as-a-Computational-Graph" title="Permalink"></a></h2><p>As an example, we consider solving the Poisson&#39;s equation  <span>$\nabla \cdot (\kappa\nabla u) = f, \mathbf{x}\in \partial \Omega; \qquad u(\mathbf{x}) = 0, \mathbf{x}\in \partial \Omega$</span> Here <span>$\kappa$</span> is an unknown parameter, which we want to estimate. The corresponding variational form is  <span>$\int_\Omega\kappa \nabla u\cdot \nabla vdx = - \int_\Omega fv dx$</span> In PoreFlow, consider a <span>$(m+1)\times (n+1)$</span> uniform grid with step size <span>$h$</span>, the finite element solution can be expressed as </p><pre><code class="language-julia">κ = Variable(1.0)
A = κ * compute_fem_laplace_matrix1(m, n, h)
F0 = eval_f_on_gauss_pts(f, m, n, h)
F = compute_fem_source_term1(F0, m, n, h)
sol = A\F </code></pre><p>In the inverse problem, we formulate the loss function as the difference of the solution vector <code>sol</code> and observations <code>obs</code> at the indices <code>idx</code></p><pre><code class="language-julia">loss = sum((sol[idx] - obs[idx])^2)</code></pre><p>Note at this point, only the part of the computation that does not depend on <span>$\kappa$</span> is carried out (partial evaluation), and the evaluation of <code>sol</code> is deferred to a later stage. The numerical computation for the partial evaluation is done using Julia and at compilation time. This eliminates much overhead for the optimization phase because only the variable part of the computational graph is executed many times. </p><p><img src="assets/cg_for_poisson.png" alt/></p><p>The computational graph is constructed implicitly, and users can calculate the gradients, whose computation is also deferred, using </p><pre><code class="language-julia">gradients(loss, ν)</code></pre><p>To trigger the executation of the computational graph, users can run </p><pre><code class="language-julia">sess = Session(); init(sess)
run(sess, loss)</code></pre><p>The optimization is a one-liner thanks to the ADCME backend:</p><pre><code class="language-julia">BFGS!(sess, loss)</code></pre><h2 id="Coupling-Deep-Neural-Networks-and-PDEs"><a class="docs-heading-anchor" href="#Coupling-Deep-Neural-Networks-and-PDEs">Coupling Deep Neural Networks and PDEs</a><a id="Coupling-Deep-Neural-Networks-and-PDEs-1"></a><a class="docs-heading-anchor-permalink" href="#Coupling-Deep-Neural-Networks-and-PDEs" title="Permalink"></a></h2><p>Because of the novel idea of expressing numerical simulators as computational graphs, it is extremely easy to coupled deep neural networks or other parametric models with partial differential equations. For example, if we want to use a deep neural network to approximate a spatially-varying <span>$\kappa(\mathbf{x})$</span>, we can use the following codes as a drop-in substitute</p><pre><code class="language-julia">x = gauss_nodes(m, n, h)
κ = fc(x, [20,20,20,1])
A = compute_fem_laplace_matrix1(κ, m, n, h)</code></pre><h2 id="Installation"><a class="docs-heading-anchor" href="#Installation">Installation</a><a id="Installation-1"></a><a class="docs-heading-anchor-permalink" href="#Installation" title="Permalink"></a></h2><p>To install the latest version of PoreFlow, try</p><pre><code class="language-julia-repl">julia&gt; ]
pkg&gt; add https://github.com/kailaix/PoreFlow.jl#master 
pkg&gt; build PoreFlow</code></pre></article><nav class="docs-footer"><a class="docs-footer-nextpage" href="gallery/">PDE Galleries »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Wednesday 7 October 2020 03:05">Wednesday 7 October 2020</span>. Using Julia version 1.4.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
