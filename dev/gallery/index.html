<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>PDE Galleries · PoreFlow</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">PoreFlow</span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">PoreFlow.jl Documentation</a></li><li class="is-active"><a class="tocitem" href>PDE Galleries</a><ul class="internal"><li><a class="tocitem" href="#Poisson&#39;s-Equation"><span>Poisson&#39;s Equation</span></a></li><li><a class="tocitem" href="#Stokes&#39;s-Problem"><span>Stokes&#39;s Problem</span></a></li><li><a class="tocitem" href="#Heat-Transfer"><span>Heat Transfer</span></a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../coupled/">Coupled Geomechanics and Single Phase Flow</a></li><li><a class="tocitem" href="../staticelasticity/">Static Linear Elasticity</a></li><li><a class="tocitem" href="../plasticity/">Plasticity</a></li><li><a class="tocitem" href="../viscoelasticity/">Viscoelasticity</a></li><li><a class="tocitem" href="../viscoelasticity_earth/">Modeling Viscoelasticity of the Earth</a></li><li><a class="tocitem" href="../earthquake/">Earthquake Simulation with Rate-and-State Friction</a></li><li><a class="tocitem" href="../heatequation/">Heat Equation</a></li><li><a class="tocitem" href="../elastodynamics/">Elastodynamics</a></li><li><a class="tocitem" href="../twophaseflow/">Coupled Geomechanics and Multiphase Flow</a></li><li><a class="tocitem" href="../NavierStokes2/">Navier-Stokes equations</a></li><li><a class="tocitem" href="../SteadyStateNavierStokes/">Steady-state Navier-Stokes equations</a></li><li><a class="tocitem" href="../CHTCoupled/">Conjugate heat transfer coupled solver for incompressible fluid</a></li></ul></li><li><span class="tocitem">Inverse Modeling</span><ul><li><a class="tocitem" href="../inverse/">Inverse Modeling for Poroelasticity Models</a></li><li><a class="tocitem" href="../inv_viscoelasticity/">Inverse Modeling for Space Varying Viscoelasticity</a></li><li><a class="tocitem" href="../coupled_viscoelasticity/">Coupled Viscoelasticity and Single Phase Flow</a></li><li><a class="tocitem" href="../inv_twophaseflow/">Coupled Geomechanics and Multiphase Flow</a></li><li><a class="tocitem" href="../inv_viscoelasticity_nonparametric/">Inverse Modeling for Nonparametric Viscoelasticity</a></li><li><a class="tocitem" href="../inv_viscoelasticity_earth/">Viscoelasticity Model for the Earth</a></li></ul></li><li><span class="tocitem">Unstructured Mesh</span><ul><li><a class="tocitem" href="../mfem_tutorial/">Unstructured Meshes in PoreFlow</a></li><li><a class="tocitem" href="../mfem_mesh/">Construct Unstructured Meshes for PoreFlow</a></li><li><a class="tocitem" href="../dev_unstructured/">Adding Custom Operators for Unstructured Meshes</a></li></ul></li><li><a class="tocitem" href="../api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>PDE Galleries</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>PDE Galleries</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/kailaix/PoreFlow.jl/blob/master/docs/src/gallery.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="PDE-Galleries"><a class="docs-heading-anchor" href="#PDE-Galleries">PDE Galleries</a><a id="PDE-Galleries-1"></a><a class="docs-heading-anchor-permalink" href="#PDE-Galleries" title="Permalink"></a></h1><p>Here is a collection of common partial differential equations and how you can solve them using the PoreFlow library. Unless we specify particularly, the computational domain will be <span>$\Omega = [0,1]^2$</span>. The configuration of the computational domain is as follows</p><p><img src="../assets/domain.png" alt/></p><p>We only show the forward modeling, but the inverse modeling is a by-product of the AD-capable implementation!</p><h2 id="Poisson&#39;s-Equation"><a class="docs-heading-anchor" href="#Poisson&#39;s-Equation">Poisson&#39;s Equation</a><a id="Poisson&#39;s-Equation-1"></a><a class="docs-heading-anchor-permalink" href="#Poisson&#39;s-Equation" title="Permalink"></a></h2><p>Consider the Poisson&#39;s equation </p><div>\[-\Delta u = f \qquad u|_{\partial \Omega} = 0\]</div><p>The analytical solution is given by </p><div>\[u(x,y) = \sin \pi x \sin \pi y\]</div><p>We have</p><div>\[f(x,y) = 2\pi^2 \sin \pi x \sin \pi y\]</div><pre><code class="language-julia">using PyPlot 
using PoreFlow

m = 50; n = 50; h = 1/n 

A = constant(compute_fem_laplace_matrix1(m, n, h))
F = eval_f_on_gauss_pts((x,y)-&gt;2π^2*sin(π*x)*sin(π*y), m, n, h)
bd = bcnode(&quot;all&quot;, m, n, h)
A, _ = fem_impose_Dirichlet_boundary_condition1(A, bd, m, n, h)
rhs = compute_fem_source_term1(F, m, n, h)
rhs[bd] .= 0.0
sol = A\rhs

sess = Session(); init(sess)
S = run(sess, sol)

figure(figsize=(10,4))
subplot(121)
visualize_scalar_on_fem_points(S, m, n, h)
title(&quot;Computed&quot;)
subplot(122)
visualize_scalar_on_fem_points(eval_f_on_fem_pts((x,y)-&gt;sin(π*x)*sin(π*y), m, n, h), m, n, h)
title(&quot;Reference&quot;)</code></pre><p><img src="../assets/gallery/poisson.png" alt/></p><h2 id="Stokes&#39;s-Problem"><a class="docs-heading-anchor" href="#Stokes&#39;s-Problem">Stokes&#39;s Problem</a><a id="Stokes&#39;s-Problem-1"></a><a class="docs-heading-anchor-permalink" href="#Stokes&#39;s-Problem" title="Permalink"></a></h2><p>The Stokes problem is given by </p><div>\[\begin{aligned}
-\nu\Delta \mathbf{u} + \nabla p &amp;= \mathbf{f} &amp; \text{ in } \Omega \\ 
\nabla \cdot \mathbf{u} &amp;= 0 &amp; \text{ in } \Omega \\ 
\mathbf{u} &amp;= \mathbf{0} &amp; \text{ on } \partial \Omega
\end{aligned}\]</div><p>Here <span>$\nu$</span> denotes the fluid viscosity, <span>$f$</span> is the unit external volumetric force acting on the fluid, <span>$p$</span> is the pressure, and <span>$\mathbf{u}$</span> is the fluid velocity. </p><p>The boundary conditions are given by </p><div>\[\begin{aligned}
\mathbf{u} &amp; = \mathbf{0} &amp; \text{ in } \Gamma_1 \\ 
\mathbf{u} \times \mathbf{n} &amp; = \mathbf{0} &amp; \text{ on } \Gamma_2 \\ 
p &amp;= p_0 &amp; \text{ on } \Gamma_2
\end{aligned}\]</div><p>Here <span>$\partial \Omega = \bar\Gamma_1\cup \bar \Gamma_2$</span>, <span>$\Gamma_1\cap \Gamma_2 = \emptyset$</span>. </p><p>The second boundary condition indicates that there is no tangential flow. A realistic example is  the cerebral venous network. <span>$\Gamma_1$</span>  corresponds to the lateral boundary (the vessel wall), and <span>$\Gamma_2$</span> corresponds to the the union of inflow/outflow boundaries. </p><div class="admonition is-info"><header class="admonition-header">Info</header><div class="admonition-body"><p>In the weak form, the boundary term from <span>$-\nu\Delta\mathbf{u}$</span> is  <span>$\int_\Omega u_x v_1 n_1 + u_y v_1 n_2 + v_x v_2 n_1 + v_2 v_2 n_2 d\mathbf{x}$</span> Note that on the no tangential flow boundary gives  <span>$un_2 = n_1 v \Rightarrow u_y n_2  = v_y n_1$</span> Additionally, we have from incompressibility  <span>$u_x + v_y = 0$</span></p><p>Combining the above two equations we have <span>$u_x v_1 n_1 + u_y v_1 n_2 = 0$</span></p><p>Likewise, <span>$v_x v_2 n_1 + v_2 v_2 n_2 = 0$</span> on the no tangential boundary. For the other boundary <span>$\Gamma_1$</span>, these two terms vanishes because <span>$v_1 = v_2 = 0$</span>. Therefore, the current boundary condition leads to a zero boundary term. </p></div></div><p>We consider the following analytical solution </p><div>\[\begin{aligned}
u(x,y) = 2\pi\sin(\pi x)\sin(\pi x)\cos(\pi y)\sin(\pi y) \\
v(x,y) = -2\pi\sin(\pi x)\sin(\pi y)\cos(\pi x)\sin(\pi y) \\ 
p(x,y) = \sin(\pi x)\sin(\pi y)
\end{aligned}\]</div><p>and we let <span>$\nu=0.5$</span>. </p><pre><code class="language-julia">using PoreFlow
using PyPlot
using SparseArrays

m = 60
n = 60
h = 1/n

function f1func(x,y)
    18.8495559215388*pi^2*sin(pi*x)^2*sin(pi*y)*cos(pi*y) - 6.28318530717959*pi^2*sin(pi*y)*cos(pi*x)^2*cos(pi*y) + pi*sin(pi*y)*cos(pi*x)
end
function f2func(x,y)
    -18.8495559215388*pi^2*sin(pi*x)*sin(pi*y)^2*cos(pi*x) + 6.28318530717959*pi^2*sin(pi*x)*cos(pi*x)*cos(pi*y)^2 + pi*sin(pi*x)*cos(pi*y)
end


ν = 0.5
K = ν*constant(compute_fem_laplace_matrix(m, n, h))
B = constant(compute_interaction_matrix(m, n, h))
Z = [K -B&#39;
-B spdiag(zeros(size(B,1)))]

bd = bcnode(&quot;all&quot;, m, n, h)
bd = [bd; bd .+ (m+1)*(n+1); ((1:m) .+ 2(m+1)*(n+1))]
Z, _ = fem_impose_Dirichlet_boundary_condition1(Z, bd, m, n, h)


F1 = eval_f_on_gauss_pts(f1func, m, n, h)
F2 = eval_f_on_gauss_pts(f2func, m, n, h)
F = compute_fem_source_term(F1, F2, m, n, h)
xy = fvm_nodes(m, n, h)
rhs = [F;zeros(m*n)]
rhs[bd] .= 0.0
sol = Z\rhs 

sess = Session(); init(sess)
S = run(sess, sol)

xy = fem_nodes(m, n, h)
x, y = xy[:,1], xy[:,2]
U = @. 2*pi*sin(pi*x)*sin(pi*x)*cos(pi*y)*sin(pi*y)
figure(figsize=(12,5))
subplot(121)
visualize_scalar_on_fem_points(U, m, n, h)
title(&quot;Reference&quot;)
subplot(122)
visualize_scalar_on_fem_points(S[1:(m+1)*(n+1)], m, n, h)
title(&quot;Computed&quot;)
savefig(&quot;stokes1.png&quot;)

U = @. -2*pi*sin(pi*x)*sin(pi*y)*cos(pi*x)*sin(pi*y)
figure(figsize=(12,5))
subplot(121)
visualize_scalar_on_fem_points(U, m, n, h)
title(&quot;Reference&quot;)
subplot(122)
visualize_scalar_on_fem_points(S[(m+1)*(n+1)+1:2(m+1)*(n+1)], m, n, h)
title(&quot;Computed&quot;)
savefig(&quot;stokes2.png&quot;)


xy = fvm_nodes(m, n, h)
x, y = xy[:,1], xy[:,2]
p = @. sin(pi*x)*sin(pi*y)
figure(figsize=(12,5))
subplot(121)
visualize_scalar_on_fvm_points(p, m, n, h)
title(&quot;Reference&quot;)
subplot(122)
visualize_scalar_on_fvm_points(S[2(m+1)*(n+1)+1:end], m, n, h)
title(&quot;Computed&quot;)</code></pre><table><tr><th style="text-align: right">Variable</th><th style="text-align: right">Result</th></tr><tr><td style="text-align: right"><span>$u$</span></td><td style="text-align: right"><img src="../assets/gallery/stokes_u.png" alt/></td></tr><tr><td style="text-align: right"><span>$v$</span></td><td style="text-align: right"><img src="../assets/gallery/stokes_v.png" alt/></td></tr><tr><td style="text-align: right"><span>$p$</span></td><td style="text-align: right"><img src="../assets/gallery/stokes_p.png" alt/></td></tr></table><h2 id="Heat-Transfer"><a class="docs-heading-anchor" href="#Heat-Transfer">Heat Transfer</a><a id="Heat-Transfer-1"></a><a class="docs-heading-anchor-permalink" href="#Heat-Transfer" title="Permalink"></a></h2><p>We consider the following heat transfer equation </p><div>\[\begin{aligned}
\frac{\partial T}{\partial t} + \mathbf{u} \cdot \nabla T - \nabla^2 T = f \\ 
T|_{\partial \Omega} = 0
\end{aligned}\]</div><h3 id="Test-Problem"><a class="docs-heading-anchor" href="#Test-Problem">Test Problem</a><a id="Test-Problem-1"></a><a class="docs-heading-anchor-permalink" href="#Test-Problem" title="Permalink"></a></h3><p>Let us first consider a test problem and consider the analytical solution </p><div>\[T(x,y) = (1-x)x(1-y)ye^{-t}\]</div><p>and <span>$\mathbf{u} = \begin{pmatrix} 1&amp; 1 \end{pmatrix}$</span>. The right hand side is given by </p><pre><code class="language-julia">using SymPy
x, y, t = @vars x y t 
T = (1-x)*x*(1-y)*y*exp(-t)
f = diff(T, t) + diff(T, x) + diff(T, y) - diff(diff(T, x), x) - diff(diff(T, y), y)
println(replace(replace(sympy.julia_code(f), &quot;.*&quot;=&gt;&quot;*&quot;), &quot;.^&quot;=&gt;&quot;^&quot;))</code></pre><p>We can plug the source term into the code </p><pre><code class="language-julia">using PoreFlow
using PyPlot

m = 50
n = 50
h = 1/n
NT = 100
Δt = 1/NT 


u = [ones(m*n);ones(m*n)]

bd = bcedge(&quot;all&quot;, m, n, h)

M = compute_fvm_mass_matrix(m, n, h)
K, rhs1 = compute_fvm_advection_matrix(u, bd, zeros(size(bd, 1)), m, n, h)
S, rhs2 = compute_fvm_tpfa_matrix(missing, bd, zeros(size(bd, 1)), m, n, h)

function Func(x, y, t)
    -x*y*(1 - x)*(1 - y)*exp(-t) - x*y*(1 - x)*exp(-t) - x*y*(1 - y)*exp(-t) + x*(1 - x)*(1 - y)*exp(-t) + 2*x*(1 - x)*exp(-t) + y*(1 - x)*(1 - y)*exp(-t) + 2*y*(1 - y)*exp(-t)
end

A = M/Δt + K - S 
A = factorize(A)
U = zeros(m*n, NT+1)
xy = fvm_nodes(m, n, h)
x, y = xy[:,1], xy[:,2]
u0 = @. x*(1-x)*y*(1-y)
F = zeros(NT+1, m*n)
Solution = zeros(NT+1, m*n)
for i = 1:NT+1
    t = (i-1)*Δt
    F[i,:] = h^2 * @. Func(x, y, t)
    Solution[i,:] = eval_f_on_fvm_pts((x,y)-&gt;(1-x)*x*(1-y)*y*exp(-t), m,n, h)
end
F = constant(F)

function condition(i, args...)
    i &lt;= NT
end

function body(i, u_arr)
    u = read(u_arr, i)
    u_arr = write(u_arr, i+1, A\(M*u/Δt - rhs1 + rhs2 + F[i+1]))
    return i+1, u_arr
end

i = constant(1, dtype = Int32)
u_arr = TensorArray(NT+1)
u_arr = write(u_arr, 1, u0)
_, u = while_loop(condition, body, [i, u_arr])
u = set_shape(stack(u), (NT+1, m*n))


sess = Session(); init(sess)
U = run(sess, u)
Z = zeros(NT+1, n, m)


p = visualize_scalar_on_fvm_points(U, m, n, h)
# saveanim(p, &quot;heat_sol.gif&quot;)

p = visualize_scalar_on_fvm_points(abs.(U-Solution), m, n, h)
# saveanim(p, &quot;heat_error.gif&quot;)
</code></pre><table><tr><th style="text-align: right">Computed</th><th style="text-align: right">Error</th></tr><tr><td style="text-align: right"><img src="../assets/gallery/heat_sol.gif" alt/></td><td style="text-align: right"><img src="./asset/gallery/../../assets/gallery/heat_error.gif" alt/></td></tr></table><h3 id="Advection-Effect"><a class="docs-heading-anchor" href="#Advection-Effect">Advection Effect</a><a id="Advection-Effect-1"></a><a class="docs-heading-anchor-permalink" href="#Advection-Effect" title="Permalink"></a></h3><p>Now let us consider the advection effect. The upper and lower boundaries are fixed Dirichlet boundaries. The left and right are no-flow boundaries </p><div>\[\frac{\partial T}{\partial n} = 0\]</div><pre><code class="language-julia">using PoreFlow
using PyPlot

m = 40
n = 20
h = 1/n
NT = 100
Δt = 1/NT 


u = 0.5*[ones(m*n);zeros(m*n)]

up_and_down = bcedge(&quot;upper|lower&quot;, m, n, h)

M = compute_fvm_mass_matrix(m, n, h)
K, rhs1 = compute_fvm_advection_matrix(u, up_and_down, zeros(size(up_and_down, 1)), m, n, h)
S, rhs2 = compute_fvm_tpfa_matrix(missing, up_and_down, zeros(size(up_and_down, 1)), m, n, h)

A = M/Δt + K - 0.01*S 
A = factorize(A)

U = zeros(m*n, NT+1)
xy = fvm_nodes(m, n, h)
u0 = @. exp( - 10 * ((xy[:,1]-1.0)^2 + (xy[:,2]-0.5)^2))

function condition(i, args...)
    i &lt;= NT
end

function body(i, u_arr)
    u = read(u_arr, i)
    u_arr = write(u_arr, i+1, A\(M*u/Δt - rhs1 + rhs2))
    return i+1, u_arr
end

i = constant(1, dtype = Int32)
u_arr = TensorArray(NT+1)
u_arr = write(u_arr, 1, u0)
_, u = while_loop(condition, body, [i, u_arr])
u = set_shape(stack(u), (NT+1, m*n))


sess = Session(); init(sess)
U = run(sess, u)
Z = zeros(NT+1, n, m)
for i = 1:NT+1
    Z[i,:,:] = reshape(U[i,:], m, n)&#39;
end
p = visualize_scalar_on_fvm_points(Z, m, n, h)
saveanim(p, &quot;advec.gif&quot;)
</code></pre><p><img src="../assets/gallery/advec.gif" alt/></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« PoreFlow.jl Documentation</a><a class="docs-footer-nextpage" href="../coupled/">Coupled Geomechanics and Single Phase Flow »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Thursday 1 October 2020 08:54">Thursday 1 October 2020</span>. Using Julia version 1.4.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
