<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Coupled Viscoelasticity and Single Phase Flow · PoreFlow</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">PoreFlow</span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../coupled/">Coupled Geomechanics and Single Phase Flow</a></li><li><a class="tocitem" href="../staticelasticity/">Static Linear Elasticity</a></li><li><a class="tocitem" href="../plasticity/">Plasticity</a></li><li><a class="tocitem" href="../viscoelasticity/">Viscoelasticity</a></li><li><a class="tocitem" href="../heatequation/">Heat Equation</a></li><li><a class="tocitem" href="../elastodynamics/">Elastodynamics</a></li></ul></li><li><span class="tocitem">Inverse Modeling</span><ul><li><a class="tocitem" href="../inverse/">Inverse Modeling for Coupled Geomechanics and Single Phase Flow</a></li><li><a class="tocitem" href="../inv_viscoelasticity/">Viscoelasticity Inversion</a></li><li class="is-active"><a class="tocitem" href>Coupled Viscoelasticity and Single Phase Flow</a><ul class="internal"><li><a class="tocitem" href="#Numerical-Results-1"><span>Numerical Results</span></a></li><li><a class="tocitem" href="#Simulation-Codes-1"><span>Simulation Codes</span></a></li><li><a class="tocitem" href="#Inverse-Modeling-1"><span>Inverse Modeling</span></a></li></ul></li></ul></li><li><a class="tocitem" href="../api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Inverse Modeling</a></li><li class="is-active"><a href>Coupled Viscoelasticity and Single Phase Flow</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Coupled Viscoelasticity and Single Phase Flow</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/kailaix/PoreFlow.jl/blob/master/docs/src/coupled_viscoelasticity.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Coupled-Viscoelasticity-and-Single-Phase-Flow-1"><a class="docs-heading-anchor" href="#Coupled-Viscoelasticity-and-Single-Phase-Flow-1">Coupled Viscoelasticity and Single Phase Flow</a><a class="docs-heading-anchor-permalink" href="#Coupled-Viscoelasticity-and-Single-Phase-Flow-1" title="Permalink"></a></h1><p>A more complex case is when the constitutive relation is given by the <a href="https://kailaix.github.io/PoreFlow.jl/dev/viscoelasticity/">viscoelasticity</a>. We consider the same governing equation as the <a href="https://kailaix.github.io/PoreFlow.jl/dev/coupled/">linear elasticity case</a></p><div>\[\begin{align}
\mathrm{div}\sigma(u) - b \nabla p &amp;= 0 \tag{1}\\
\frac{1}{M} \frac{\partial p}{\partial t} + b\frac{\partial \varepsilon_v(u)}{\partial t} - \nabla\cdot\left(\frac{k}{B_f\mu}\nabla p\right) &amp;= f(x,t)
\end{align}\]</div><p>with boundary conditions</p><div>\[\begin{aligned}
\sigma n = 0,\quad x\in \Gamma_{N}^u, \qquad u=0, \quad x\in \Gamma_D^u\\
-\frac{k}{B_f\mu}\frac{\partial p}{\partial n} = 0,\quad x\in \Gamma_{N}^p, \qquad p=g, \quad x\in \Gamma_D^p
\end{aligned}\]</div><p>and the initial condition</p><div>\[p(x,0) = p_0,\ u(x,0) =0,\ x\in \Omega\]</div><p>The only difference is that the consitutive relation is given by the <a href="https://kailaix.github.io/PoreFlow.jl/dev/viscoelasticity/#Numerical-Example-1">Maxwell material equation</a>, which has the following form in the discretization </p><div>\[\sigma^{n+1} = H \varepsilon^{n+1} + S \sigma^n  - H\varepsilon^n\]</div><p>The discretization for Eq. (1) is </p><div>\[\int_\Omega H \varepsilon^{n+1} : \delta \varepsilon \;\mathrm{d}x- \int_\Omega b p \delta u \;\mathrm{d}x = \int_{\partial \Omega} \mathbf{t} \;\mathrm{d}s + \int_{\Omega} H\varepsilon^n : \delta\varepsilon \;\mathrm{d} x - \int_\Omega S\sigma^n : \delta \varepsilon \;\mathrm{d} x\]</div><h2 id="Numerical-Results-1"><a class="docs-heading-anchor" href="#Numerical-Results-1">Numerical Results</a><a class="docs-heading-anchor-permalink" href="#Numerical-Results-1" title="Permalink"></a></h2><p>We run the results with three different viscosity <span>$\eta = 1/10000, 1$</span>, and <span>$10$</span>. We have the following results</p><table><tr><th style="text-align: right">Description</th><th style="text-align: right"><span>$\eta=1/10000$</span></th><th style="text-align: right"><span>$\eta=1$</span></th><th style="text-align: right"><span>$\eta=10$</span></th></tr><tr><td style="text-align: right">Pressure</td><td style="text-align: right"><img src="../assets/visco/disp_p_visco10000.0.gif" alt/></td><td style="text-align: right"><img src="../assets/visco/disp_p_visco1.0.gif" alt/></td><td style="text-align: right"><img src="../assets/visco/disp_p_visco0.1.gif" alt/></td></tr><tr><td style="text-align: right"><span>$\sigma_{xx}$</span></td><td style="text-align: right"><img src="../assets/visco/disp_sxx_visco10000.0.gif" alt/></td><td style="text-align: right"><img src="../assets/visco/disp_sxx_visco1.0.gif" alt/></td><td style="text-align: right"><img src="../assets/visco/disp_sxx_visco0.1.gif" alt/></td></tr><tr><td style="text-align: right"><span>$\sigma_{xy}$</span></td><td style="text-align: right"><img src="../assets/visco/disp_syy_visco10000.0.gif" alt/></td><td style="text-align: right"><img src="../assets/visco/disp_syy_visco1.0.gif" alt/></td><td style="text-align: right"><img src="../assets/visco/disp_syy_visco0.1.gif" alt/></td></tr><tr><td style="text-align: right"><span>$\sigma_{yy}$</span></td><td style="text-align: right"><img src="../assets/visco/disp_sxy_visco10000.0.gif" alt/></td><td style="text-align: right"><img src="../assets/visco/disp_sxy_visco1.0.gif" alt/></td><td style="text-align: right"><img src="../assets/visco/disp_sxy_visco0.1.gif" alt/></td></tr><tr><td style="text-align: right"><span>$u$</span></td><td style="text-align: right"><img src="../assets/visco/disp_u_visco10000.0.gif" alt/></td><td style="text-align: right"><img src="../assets/visco/disp_u_visco1.0.gif" alt/></td><td style="text-align: right"><img src="../assets/visco/disp_u_visco0.1.gif" alt/></td></tr><tr><td style="text-align: right"><span>$v$</span></td><td style="text-align: right"><img src="../assets/visco/disp_v_visco10000.0.gif" alt/></td><td style="text-align: right"><img src="../assets/visco/disp_v_visco1.0.gif" alt/></td><td style="text-align: right"><img src="../assets/visco/disp_v_visco0.1.gif" alt/></td></tr><tr><td style="text-align: right"><span>$\sigma_{xx}$</span> at the center point</td><td style="text-align: right"><img src="../assets/visco/sigmaxx10000.0.jpeg" alt/></td><td style="text-align: right"><img src="../assets/visco/sigmaxx1.0.jpeg" alt/></td><td style="text-align: right"><img src="../assets/visco/sigmaxx0.1.jpeg" alt/></td></tr><tr><td style="text-align: right"><span>$u$</span> at the center point</td><td style="text-align: right"><img src="../assets/visco/ux10000.0.jpeg" alt/></td><td style="text-align: right"><img src="../assets/visco/ux1.0.jpeg" alt/></td><td style="text-align: right"><img src="../assets/visco/ux0.1.jpeg" alt/></td></tr><tr><td style="text-align: right"><span>$\varepsilon_{xx}$</span> at the center point</td><td style="text-align: right"><img src="../assets/visco/varepsilonxx10000.0.jpeg" alt/></td><td style="text-align: right"><img src="../assets/visco/varepsilonxx1.0.jpeg" alt/></td><td style="text-align: right"><img src="../assets/visco/varepsilonxx0.1.jpeg" alt/></td></tr></table><h2 id="Simulation-Codes-1"><a class="docs-heading-anchor" href="#Simulation-Codes-1">Simulation Codes</a><a class="docs-heading-anchor-permalink" href="#Simulation-Codes-1" title="Permalink"></a></h2><pre><code class="language-julia">using Revise
using PoreFlow
using PyCall
using LinearAlgebra
using ADCME
using MAT
using PyPlot
np = pyimport(&quot;numpy&quot;)

# Domain information 
NT = 50
Δt = 1/NT
n = 20
m = 2*n 
h = 1.0/n 
bdnode = Int64[]
for i = 1:m+1
    for j = 1:n+1
        if i==1 || i==m+1 || j==1|| j==n+1
            push!(bdnode, (j-1)*(m+1)+i)
        end
    end
end

is_training = false
b = 1.0

invη = 1.0
if length(ARGS)==1
    global invη = parse(Float64, ARGS[1])
end

λ = constant(2.0)
μ = constant(0.5)
invη = constant(invη)

iS = tensor(
    [1+2/3*μ*Δt*invη -1/3*μ*Δt*invη 0.0
    -1/3*μ*Δt*invη 1+2/3*μ*Δt*invη 0.0 
    0.0 0.0 1+μ*Δt*invη]
)
S = inv(iS)
H = S * tensor([
    2μ+λ λ 0.0
    λ 2μ+λ 0.0
    0.0 0.0 μ
])


Q = SparseTensor(compute_fvm_tpfa_matrix(m, n, h))
K = compute_fem_stiffness_matrix(H, m, n, h)
L = SparseTensor(compute_interaction_matrix(m, n, h))
M = SparseTensor(compute_fvm_mass_matrix(m, n, h))
A = [K -b*L&#39;
b*L/Δt 1/Δt*M-Q]
A, Abd = fem_impose_coupled_Dirichlet_boundary_condition(A, bdnode, m, n, h)
# error()
U = zeros(m*n+2(m+1)*(n+1), NT+1)
x = Float64[]; y = Float64[]
for j = 1:n+1
    for i = 1:m+1
        push!(x, (i-1)*h)
        push!(y, (j-1)*h)
    end
end
    
injection = (div(n,2)-1)*m + 3
production = (div(n,2)-1)*m + m-3


function condition(i, tas...)
    i&lt;=NT
end

function body(i, tas...)
    ta_u, ta_ε, ta_σ = tas
    u = read(ta_u, i)
    σ0 = read(ta_σ, i)
    ε0 = read(ta_ε, i)
    rhs1 = compute_fem_viscoelasticity_strain_energy_term(ε0, σ0, S, H, m, n, h)
    rhs2 = zeros(m*n)
    rhs2[injection] += 1.0
    rhs2[production] -= 1.0
    rhs2 += b*L*u[1:2(m+1)*(n+1)]/Δt + 
            M * u[2(m+1)*(n+1)+1:end]/Δt
    rhs = [rhs1;rhs2]
    o = A\rhs 

    ε = eval_strain_on_gauss_pts(o, m, n, h)
    σ = σ0*S + (ε - ε0)*H
    ta_u = write(ta_u, i+1, o)
    ta_ε = write(ta_ε, i+1, ε)
    ta_σ = write(ta_σ, i+1, σ)
    i+1, ta_u, ta_ε, ta_σ
end

i = constant(1, dtype=Int32)
ta_u = TensorArray(NT+1); ta_u = write(ta_u, 1, constant(zeros(2(m+1)*(n+1)+m*n)))
ta_ε = TensorArray(NT+1); ta_ε = write(ta_ε, 1, constant(zeros(4*m*n, 3)))
ta_σ = TensorArray(NT+1); ta_σ = write(ta_σ, 1, constant(zeros(4*m*n, 3)))
_, u_out, ε_out, σ_out = while_loop(condition, body, [i, ta_u, ta_ε, ta_σ])
u_out = stack(u_out)
u_out.set_shape((NT+1, size(u_out,2)))
σ_out = stack(σ_out)
ε_out = stack(ε_out)

upper_idx = Int64[]
for i = 1:m+1
    push!(upper_idx, (div(n,3)-1)*(m+1)+i)
    push!(upper_idx, (div(n,3)-1)*(m+1)+i + (m+1)*(n+1))
end
for i = 1:m 
    push!(upper_idx, (div(n,3)-1)*m+i+2(m+1)*(n+1))
end

sess = Session(); init(sess)
U, Sigma, Varepsilon, ev = run(sess, [u_out,σ_out,ε_out, invη])
visualize_displacement(U&#39;|&gt;Array, m, n, h, name=&quot;_visco$ev&quot;)
visualize_pressure(U&#39;|&gt;Array, m, n, h, name=&quot;_visco$ev&quot;)
visualize_scattered_displacement(U&#39;|&gt;Array, m, n, h, name=&quot;_visco$ev&quot;)
visualize_stress(Sigma[:,:,1]&#39;|&gt;Array, m, n, h, name=&quot;xx_visco$ev&quot;)
visualize_stress(Sigma[:,:,2]&#39;|&gt;Array, m, n, h, name=&quot;yy_visco$ev&quot;)
visualize_stress(Sigma[:,:,3]&#39;|&gt;Array, m, n, h, name=&quot;xy_visco$ev&quot;)


idx = m÷2 + (n÷2)*m
close(&quot;all&quot;)
plot(LinRange(0,1.0, NT+1),Sigma[:,4*(idx-1)+1,1])
xlabel(&quot;time&quot;)
ylabel(&quot;\$\\sigma_{xx}\$&quot;)
savefig(&quot;sigmaxx$ev.jpeg&quot;)

close(&quot;all&quot;)
plot(LinRange(0,1.0, NT+1),Varepsilon[:,4*(idx-1)+1,1])
xlabel(&quot;time&quot;)
ylabel(&quot;\$\\varepsilon_{xx}\$&quot;)
savefig(&quot;varepsilonxx$ev.jpeg&quot;)

idx = m÷2 + (n÷2)*(m+1)
close(&quot;all&quot;)
plot(LinRange(0,1.0, NT+1),U[:,4*(idx-1)+1])
xlabel(&quot;time&quot;)
ylabel(&quot;\$u_x\$&quot;)
savefig(&quot;ux$ev.jpeg&quot;)</code></pre><h2 id="Inverse-Modeling-1"><a class="docs-heading-anchor" href="#Inverse-Modeling-1">Inverse Modeling</a><a class="docs-heading-anchor-permalink" href="#Inverse-Modeling-1" title="Permalink"></a></h2><p>In the inverse modeling, we fix the bottom boundary and impose no traction condition on all other three boundaries. </p><table><tr><th style="text-align: right">Pressure</th><th style="text-align: right"><span>$\sigma_{xx}$</span></th><th style="text-align: right"><span>$\sigma_{yy}$</span></th><th style="text-align: right"><span>$\sigma_{xy}$</span></th><th style="text-align: right"><span>$u$</span></th><th style="text-align: right"><span>$v$</span></th></tr><tr><td style="text-align: right"><img src="/Users/kailaix/Desktop/PoreFlow.jl/docs/src/assets/visco/disp_p_inv_visco1.0.gif" alt="disp_p_inv_visco1.0"/></td><td style="text-align: right"><img src="/Users/kailaix/Desktop/PoreFlow.jl/docs/src/assets/visco/disp_sxx_inv_visco1.0.gif" alt="disp_sxx_inv_visco1.0"/></td><td style="text-align: right"><img src="/Users/kailaix/Desktop/PoreFlow.jl/docs/src/assets/visco/disp_syy_inv_visco1.0.gif" alt="disp_syy_inv_visco1.0"/></td><td style="text-align: right"><img src="/Users/kailaix/Desktop/PoreFlow.jl/docs/src/assets/visco/disp_sxy_inv_visco1.0.gif" alt="disp_sxy_inv_visco1.0"/></td><td style="text-align: right"><img src="/Users/kailaix/Desktop/PoreFlow.jl/docs/src/assets/visco/disp_u_inv_visco1.0.gif" alt="disp_u_inv_visco1.0"/></td><td style="text-align: right"><img src="/Users/kailaix/Desktop/PoreFlow.jl/docs/src/assets/visco/disp_v_inv_visco1.0.gif" alt="disp_v_inv_visco1.0"/></td></tr></table><table><tr><th style="text-align: right">Displacement</th><th style="text-align: right"><span>$\sigma_{xx}$</span> at the center point</th><th style="text-align: right"><span>$\varepsilon_{xx}$</span>  at the center point</th><th style="text-align: right"><span>$u$</span> at the center point</th></tr><tr><td style="text-align: right"><img src="/Users/kailaix/Desktop/PoreFlow.jl/docs/src/assets/visco/disp_scattered_u.gif" alt="disp_scattered_u"/></td><td style="text-align: right"><img src="/Users/kailaix/Desktop/PoreFlow.jl/docs/src/assets/visco/inverse/sigmaxx1.0.jpeg" alt="sigmaxx1.0"/></td><td style="text-align: right"><img src="/Users/kailaix/Desktop/PoreFlow.jl/docs/src/assets/visco/inverse/varepsilonxx1.0.jpeg" alt="varepsilonxx1.0"/></td><td style="text-align: right"><img src="/Users/kailaix/Desktop/PoreFlow.jl/docs/src/assets/visco/inverse/ux1.0.jpeg" alt="ux1.0"/></td></tr></table></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../inv_viscoelasticity/">« Viscoelasticity Inversion</a><a class="docs-footer-nextpage" href="../api/">API »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Saturday 15 February 2020 07:20">Saturday 15 February 2020</span>. Using Julia version 1.3.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
